(function(h){h.console=h.console||{log:function(){}};h=Array.prototype;var g=h.slice;h.indexOf=h.indexOf||function(e,b){b=b||0;var a=this.length,d;if(0==a||b>=a)return-1;0>b&&(b=a+b);for(d=b;d<a;d++)if(this[d]===e)return d;return-1};h=Function.prototype;h.bind=h.bind||function(e){function b(){var c=d.concat(g.call(arguments));return a.apply(this instanceof b?this:e,c)}var a=this,d=g.call(arguments,1),f=function(){};f.prototype=a.prototype;b.prototype=new f;return b}})(window);
(function(h){for(var g=0,e=["ms","moz","webkit","o"],b=0;b<e.length&&!h.requestAnimationFrame;++b)h.requestAnimationFrame=h[e[b]+"RequestAnimationFrame"],h.cancelAnimationFrame=h[e[b]+"CancelAnimationFrame"]||h[e[b]+"CancelRequestAnimationFrame"];h.requestAnimationFrame||(h.requestAnimationFrame=function(a,d){var f=(new Date).getTime(),c=Math.max(0,16-(f-g)),k=h.setTimeout(function(){a(f+c)},c);g=f+c;return k});h.cancelAnimationFrame||(h.cancelAnimationFrame=function(a){clearTimeout(a)})})(window);
(function(h){var g=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;String.prototype.toColorRgb=function(){var e=this.toLowerCase();return e&&g.test(e)?4===e.length?{r:parseInt("0x"+e.charAt(1)+e.charAt(1)),g:parseInt("0x"+e.charAt(2)+e.charAt(2)),b:parseInt("0x"+e.charAt(3)+e.charAt(3))}:{r:parseInt("0x"+e.slice(1,3)),g:parseInt("0x"+e.slice(3,5)),b:parseInt("0x"+e.slice(5,7))}:{r:0,g:0,b:0}}})(window);(function(h){var g=function(){var e=document,b=e.documentElement,a=0;return{getUid:function(d){var f=++a;return d?d+"_"+f:f},copy:function(a,f,c){for(var k in f)if(!c||a.hasOwnProperty(k)||void 0!==a[k])a[k]=f[k];return a},browser:function(){var a=navigator.userAgent,a={iphone:/iphone/i.test(a),ipad:/ipad/i.test(a),ipod:/ipod/i.test(a),ios:/iphone|ipad|ipod/i.test(a),android:/android/i.test(a),webkit:/webkit/i.test(a),chrome:/chrome/i.test(a),safari:/safari/i.test(a),firefox:/firefox/i.test(a),ie:/msie/i.test(a),
opera:/opera/i.test(a),supportTouch:"ontouchstart"in h,supportCanvas:null!=e.createElement("canvas").getContext,supportStorage:!1,supportOrientation:"orientation"in h,supportDeviceMotion:"ondevicemotion"in h};try{localStorage.setItem("hilo","hilo"),localStorage.removeItem("hilo"),a.supportStorage=!0}catch(f){}a.jsVendor=a.webkit?"webkit":a.firefox?"Moz":a.opera?"O":a.ie?"ms":"";a.cssVendor="-"+a.jsVendor+"-";return a}(),event:function(){var a="ontouchstart"in h;return{POINTER_START:a?"touchstart":
"mousedown",POINTER_MOVE:a?"touchmove":"mousemove",POINTER_END:a?"touchend":"mouseup"}}(),align:{TOP_LEFT:"TL",TOP:"T",TOP_RIGHT:"TR",LEFT:"L",CENTER:"C",RIGHT:"R",BOTTOM_LEFT:"BL",BOTTOM:"B",BOTTOM_RIGHT:"BR"},getElement:function(a){return e.getElementById(a)},getElementRect:function(a){try{var f=a.getBoundingClientRect()}catch(e){f={top:a.offsetTop,left:a.offsetLeft,width:a.offsetWidth,height:a.offsetHeight}}var c=(h.pageXOffset||b.scrollLeft)-(b.clientLeft||0)||0,k=(h.pageYOffset||b.scrollTop)-
(b.clientTop||0)||0,t=h.getComputedStyle?h.getComputedStyle(a):a.currentStyle,m=parseInt;a=m(t.paddingLeft)+m(t.borderLeftWidth)||0;var v=m(t.paddingTop)+m(t.borderTopWidth)||0,g=m(t.paddingRight)+m(t.borderRightWidth)||0,t=m(t.paddingBottom)+m(t.borderBottomWidth)||0,m=f.top||0,n=f.left||0;return{left:n+c+a,top:m+k+v,width:f.right-g-n-a,height:f.bottom-t-m-v}},createElement:function(a,f){var c=e.createElement(a),k,t,m;for(k in f)if(t=f[k],"style"===k)for(m in t)c.style[m]=t[m];else c[k]=t;return c},
setElementStyleByView:function(a,f){var c=g.browser.jsVendor,k=!1,t=a.parent,m=a.drawable,k=m.domElement,b=k.style,e=a._stateCache||(a._stateCache={});t&&(t=t.drawable&&t.drawable.domElement)&&t!=k.parentNode&&t.appendChild(k);this.cacheStateIfChanged(a,["visible"],e)&&(b.display=a.visible?"":"none");this.cacheStateIfChanged(a,["alpha"],e)&&(b.opacity=a.alpha);if(a.visible&&!(0>=a.alpha)){this.cacheStateIfChanged(a,["width"],e)&&(b.width=(a.width||0)+"px");this.cacheStateIfChanged(a,["height"],e)&&
(b.height=(a.height||0)+"px");this.cacheStateIfChanged(a,["depth"],e)&&(b.zIndex=a.depth+1);this.cacheStateIfChanged(a,["clipChildren"],e)&&(b.overflow=a.clipChildren?"hidden":null);if(k=this.cacheStateIfChanged(a,["pivotX","pivotY"],e))b[c+"TransformOrigin"]=a.pivotX+"px "+a.pivotY+"px";if(this.cacheStateIfChanged(a,["x","y","rotation","scaleX","scaleY"],e)||k)b[c+"Transform"]="translate("+(a.x-a.pivotX)+"px, "+(a.y-a.pivotY)+"px)rotate("+a.rotation+"deg)scale("+a.scaleX+", "+a.scaleY+")";if(f)b.pointerEvents=
"none";else if(b.pointerEvents||(b.pointerEvents="none"),this.cacheStateIfChanged(a,["background"],e)&&(b.backgroundColor=a.background),c=m.image)if(c=c.src,c!==e.image&&(e.image=c,b.backgroundImage="url("+c+")"),c=m.rect)m=c[0],c=c[1],m!==e.sx&&(e.sx=m,b.backgroundPositionX=-m+"px"),c!==e.sy&&(e.sy=c,b.backgroundPositionY=-c+"px")}},cacheStateIfChanged:function(a,f,c){var k,t,m,b,e=!1;k=0;for(t=f.length;k<t;k++)m=f[k],b=a[m],b!=c[m]&&(c[m]=b,e=!0);return e}}}();h.Hilo=g})(window);(function(h){h=h.Hilo;var g=function(){var e=function(c){var f={},a,e;for(a in c)e=c[a],b.hasOwnProperty(a)?b[a].call(this,e):f[a]=e;d(this.prototype,f)},b={Extends:function(c){var f=this.prototype,m=a(c.prototype);d(this,c);d(m,f);m.constructor=this;this.prototype=m;this.superclass=c.prototype},Mixes:function(c){c instanceof Array||(c=[c]);for(var f=this.prototype,a;a=c.shift();)d(f,a.prototype||a)},Statics:function(c){d(this,c)}},a=function(){if(Object.__proto__)return function(c){return{__proto__:c}};
var c=function(){};return function(f){c.prototype=f;return new c}}(),d=function(f){for(var a=1,d=arguments.length;a<d;a++){var b=arguments[a],e,g;for(g in b){var h=b[g];!h||"object"!==typeof h||void 0===h.value&&"function"!==typeof h.get&&"function"!==typeof h.set?f[g]=h:(e=e||{},e[g]=h)}e&&c(f,e)}return f};try{var f=Object.defineProperty,c=Object.defineProperties;f({},"$",{value:0})}catch(k){"__defineGetter__"in Object&&(f=function(c,f,a){"value"in a&&(c[f]=a.value);"get"in a&&c.__defineGetter__(f,
a.get);"set"in a&&c.__defineSetter__(f,a.set);return c},c=function(c,a){for(var k in a)a.hasOwnProperty(k)&&f(c,k,a[k]);return c})}return{create:function(c){c=c||{};var f=c.hasOwnProperty("constructor")?c.constructor:function(){};e.call(f,c);return f},mix:d}}();h.Class=g})(window);(function(h){var g=h.Hilo,e=g.Class.create({constructor:function(a,d,f){this.type=a;this.target=d;this.detail=f;this.timeStamp=+new Date},type:null,target:null,detail:null,timeStamp:0,stopImmediatePropagation:function(){this._stopped=!0}});if(h=h.Event){h=h.prototype;var b=h.stopImmediatePropagation;h.stopImmediatePropagation=function(){b&&b.call(this);this._stopped=!0}}g.Event={_listeners:null,on:function(a,d,f){var c=this._listeners=this._listeners||{};a=c[a]=c[a]||[];for(var c=0,k=a.length;c<k;c++)if(a[c].listener===
d)return;a.push({listener:d,once:f});return this},off:function(a,d){if(0==arguments.length)return this._listeners=null,this;var f=this._listeners&&this._listeners[a];if(f){if(1==arguments.length)return delete this._listeners[a],this;for(var c=0,k=f.length;c<k;c++)if(f[c].listener===d){f.splice(c,1);0===f.length&&delete this._listeners[a];break}}return this},fire:function(a,d){var f,c;"string"===typeof a?c=a:(f=a,c=a.type);var k=this._listeners;if(!k)return!1;var b=k[c];if(b){b=b.slice(0);f=f||new e(c,
this,d);if(f._stopped)return!1;for(var m=0;m<b.length;m++){var g=b[m];g.listener.call(this,f);g.once&&b.splice(m--,1)}0==b.length&&delete k[c];return!0}return!1}}})(window);(function(h){h=h.Hilo;var g=h.Class.create({constructor:function(e,b,a,d,f,c){this.a=e;this.b=b;this.c=a;this.d=d;this.tx=f;this.ty=c},concat:function(e){var b=arguments,a=this.a,d=this.b,f=this.c,c=this.d,k=this.tx,t=this.ty;if(6<=b.length)var m=b[0],g=b[1],h=b[2],n=b[3],q=b[4],b=b[5];else m=e.a,g=e.b,h=e.c,n=e.d,q=e.tx,b=e.ty;this.a=a*m+d*h;this.b=a*g+d*n;this.c=f*m+c*h;this.d=f*g+c*n;this.tx=k*m+t*h+q;this.ty=k*g+t*n+b;return this},rotate:function(e){var b=Math.sin(e);e=Math.cos(e);var a=this.a,
d=this.b,f=this.c,c=this.d,k=this.tx,t=this.ty;this.a=a*e-d*b;this.b=a*b+d*e;this.c=f*e-c*b;this.d=f*b+c*e;this.tx=k*e-t*b;this.ty=k*b+t*e;return this},scale:function(e,b){this.a*=e;this.d*=b;this.c*=e;this.b*=b;this.tx*=e;this.ty*=b;return this},translate:function(e,b){this.tx+=e;this.ty+=b;return this},identity:function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this},invert:function(){var e=this.a,b=this.b,a=this.c,d=this.d,f=this.tx,c=e*d-b*a;this.a=d/c;this.b=-b/c;this.c=-a/c;this.d=
e/c;this.tx=(a*this.ty-d*f)/c;this.ty=-(e*this.ty-b*f)/c;return this},transformPoint:function(e,b,a){var d=e.x*this.a+e.y*this.c+this.tx,f=e.x*this.b+e.y*this.d+this.ty;b&&(d=d+.5>>0,f=f+.5>>0);if(a)return{x:d,y:f};e.x=d;e.y=f;return e}});h.Matrix=g})(window);(function(h){var g=h.Hilo,e=g.Class.create({constructor:function(b){this._targetFPS=b||30;this._interval=1E3/this._targetFPS;this._tickers=[]},_paused:!1,_targetFPS:0,_interval:0,_intervalId:null,_tickers:null,_lastTime:0,_tickCount:0,_tickTime:0,_measuredFPS:0,start:function(b){if(!this._intervalId){this._lastTime=+new Date;var a=this,d=this._interval,f=h.requestAnimationFrame||h[g.browser.jsVendor+"RequestAnimationFrame"];if(b&&f)var c=function(){a._tick()},k=function(){a._intervalId=setTimeout(k,
d);f(c)};else k=function(){a._intervalId=setTimeout(k,d);a._tick()};k()}},stop:function(){clearTimeout(this._intervalId);this._intervalId=null;this._lastTime=0},pause:function(){this._paused=!0},resume:function(){this._paused=!1},_tick:function(){if(!this._paused){var b=+new Date,a=b-this._lastTime,d=this._tickers;++this._tickCount>=this._targetFPS?(this._measuredFPS=1E3/(this._tickTime/this._tickCount)+.5>>0,this._tickTime=this._tickCount=0):this._tickTime+=b-this._lastTime;this._lastTime=b;for(var b=
0,f=d.length;b<f;b++)d[b].tick(a)}},getMeasuredFPS:function(){return this._measuredFPS},addTick:function(b){if(!b||"function"!=typeof b.tick)throw Error("Ticker: The tick object must implement the tick method.");this._tickers.push(b)},removeTick:function(b){var a=this._tickers;b=a.indexOf(b);0<=b&&a.splice(b,1)}});g.Ticker=e})(window);(function(h){var g=h.Hilo,e=g.Class.create({constructor:function(b){this.init(b)},image:null,rect:null,domElement:null,init:function(b){var a=this,d=a.image;e.isDrawable(b)?a.image=b:g.copy(a,b,!0);b=a.image;if("string"===typeof b)if(d&&b===d.getAttribute("src"))b=a.image=d;else{a.image=null;var f=new Image;f.onload=function(){f.onload=null;a.init(f)};f.src=b;return}b&&!a.rect&&(a.rect=[0,0,b.width,b.height])},Statics:{isDrawable:function(b){if(!b||!b.tagName)return!1;b=b.tagName.toLowerCase();return"img"===
b||"canvas"===b||"video"===b}}});g.Drawable=e})(window);(function(h){var g=h.Hilo,e=g.Class.create({load:function(b){var a=b.src,d="jsonp"==b.type;if(d){var f=b.callbackName||"callback",c=b.callback||"jsonp"+ ++e._count;h[c]||(h[c]=function(f){delete h[c]})}d&&(a+=(-1==a.indexOf("?")?"?":"&")+f+"="+c);b.noCache&&(a+=(-1==a.indexOf("?")?"?":"&")+"t="+ +new Date);d=document.createElement("script");d.type="text/javascript";d.async=!0;d.onload=this.onLoad.bind(this);d.onerror=this.onError.bind(this);d.src=a;b.id&&(d.id=b.id);document.getElementsByTagName("head")[0].appendChild(d)},
onLoad:function(b){b=b.target;b.onload=b.onerror=null;return b},onError:function(b){var a=b.target;a.onload=a.onerror=null;return b},Statics:{_count:0}});g.ScriptLoader=e})(window);(function(h){var g=h.Hilo,e=g.Class.create({load:function(b){var a=this,d=new Image;b.crossOrigin&&(d.crossOrigin=b.crossOrigin);d.onload=function(){a.onLoad(d)};d.onerror=d.onabort=a.onError.bind(d);d.src=b.src+(b.noCache?(-1==b.src.indexOf("?")?"?":"&")+"t="+ +new Date:"")},onLoad:function(b){b=b||h.event;b.onload=b.onerror=b.onabort=null;return b},onError:function(b){var a=b.target;a.onload=a.onerror=a.onabort=null;return b}});g.ImageLoader=e})(window);(function(h){h=h.Hilo;var g=h.ImageLoader,e=h.ScriptLoader,b=h.Class.create({Mixes:h.Event,constructor:function(a){this._source=[];this.add(a)},maxConnections:2,_source:null,_loaded:0,_connections:0,_currentIndex:-1,add:function(a){a&&(a=a instanceof Array?a:[a],this._source=this._source.concat(a));return this},get:function(a){if(a)for(var d=this._source,f=0;f<d.length;f++){var c=d[f];if(c.id===a||c.src===a)return c}return null},getContent:function(a){return(a=this.get(a))&&a.content},start:function(){this._loadNext();
return this},_loadNext:function(){var a=this,d=a._source,f=d.length;if(a._loaded>=f)a.fire("complete");else if(a._currentIndex<f-1&&a._connections<a.maxConnections){var c=++a._currentIndex,d=d[c],k=a._getLoader(d);if(k){var b=k.onLoad,m=k.onError;k.onLoad=function(f){k.onLoad=b;k.onError=m;f=b&&b.call(k,f)||f.target;a._onItemLoad(c,f)};k.onError=function(f){k.onLoad=b;(k.onError=m)&&m.call(k,f);a._onItemError(c,f)};a._connections++}a._loadNext();k&&k.load(d)}},_getLoader:function(a){var d=a.loader;
if(d)return d;var f;if(!(f=a.type)){var c;if(a=a.src.match(/\/?[^/]+\.(\w+)(\?\S+)?$/i))c=a[1].toLowerCase();f=c||null}switch(f){case "png":case "jpg":case "jpeg":case "gif":d=new g;break;case "js":case "jsonp":d=new e}return d},_onItemLoad:function(a,d){var f=this._source[a];f.loaded=!0;f.content=d;this._connections--;this._loaded++;this.fire("load",f);this._loadNext()},_onItemError:function(a,d){var f=this._source[a];f.error=d;this._connections--;this._loaded++;this.fire("error",f);this._loadNext()},
getSize:function(a){for(var d=0,f=this._source,c=0;c<f.length;c++)var k=f[c],d=d+((a?k.loaded&&k.size:k.size)||0);return d},getLoaded:function(){return this._loaded},getTotal:function(){return this._source.length}});h.LoadQueue=b})(window);(function(h){var g=h.Hilo;h=g.Class.create({Mixes:g.Event,constructor:function(e){g.copy(this,e,!0);this._onAudioEvent=this._onAudioEvent.bind(this)},src:null,loop:!1,autoPlay:!1,loaded:!1,playing:!1,duration:0,volume:1,muted:!1,_element:null,load:function(){if(!this._element)try{var e=this._element=new Audio;e.addEventListener("canplaythrough",this._onAudioEvent,!1);e.addEventListener("ended",this._onAudioEvent,!1);e.addEventListener("error",this._onAudioEvent,!1);e.src=this.src;e.volume=this.volume;
e.load()}catch(b){e=this._element={},e.play=e.pause=function(){}}return this},_onAudioEvent:function(e){var b=e.type;switch(b){case "canplaythrough":e.target.removeEventListener(b,this._onAudioEvent);this.loaded=!0;this.duration=this._element.duration;this.fire("load");this.autoPlay&&this._doPlay();break;case "ended":this.playing=!1;this.fire("end");this.loop&&this._doPlay();break;case "error":this.fire("error")}},_doPlay:function(){this.playing||(this._element.volume=this.muted?0:this.volume,this._element.play(),
this.playing=!0)},play:function(){this.playing&&this.stop();this._element?this.loaded&&this._doPlay():(this.autoPlay=!0,this.load());return this},pause:function(){this.playing&&(this._element.pause(),this.playing=!1);return this},resume:function(){this.playing||this._doPlay();return this},stop:function(){this.playing&&(this._element.pause(),this._element.currentTime=0,this.playing=!1);return this},setVolume:function(e){this.volume!=e&&(this.volume=e,this._element.volume=e);return this},setMute:function(e){this.muted!=
e&&(this.muted=e,this._element.volume=e?0:this.volume);return this},Statics:{isSupported:null!==h.Audio}});g.HTMLAudio=h})(window);(function(h){var g=h.Hilo,e=g.Class,b=g.Event,a=function(){var a=h.AudioContext||h.webkitAudioContext,f=a?new a:null;return e.create({Mixes:b,constructor:function(c){g.copy(this,c,!0);this._init()},src:null,loop:!1,autoPlay:!1,loaded:!1,playing:!1,duration:0,volume:1,muted:!1,_context:null,_gainNode:null,_buffer:null,_audioNode:null,_startTime:0,_offset:0,_init:function(){this._context=f;this._gainNode=f.createGain?f.createGain():f.createGainNode();this._gainNode.connect(f.destination);this._onAudioEvent=
this._onAudioEvent.bind(this);this._onDecodeComplete=this._onDecodeComplete.bind(this);this._onDecodeError=this._onDecodeError.bind(this)},load:function(){if(!this._buffer){var c=new XMLHttpRequest;c.src=this.src;c.open("GET",this.src,!0);c.responseType="arraybuffer";c.onload=this._onAudioEvent;c.onprogress=this._onAudioEvent;c.onerror=this._onAudioEvent;c.send();this._buffer=!0}return this},_onAudioEvent:function(c){switch(c.type){case "load":c=c.target;c.onload=c.onprogress=c.onerror=null;this._context.decodeAudioData(c.response,
this._onDecodeComplete,this._onDecodeError);break;case "ended":this.playing=!1;this.fire("end");this.loop&&this._doPlay();break;case "progress":this.fire(c);break;case "error":this.fire(c)}},_onDecodeComplete:function(c){this._buffer=c;this.loaded=!0;this.duration=c.duration;this.fire("load");this.autoPlay&&this._doPlay()},_onDecodeError:function(){this.fire("error")},_doPlay:function(){this._clearAudioNode();var c=this._context.createBufferSource();c.start||(c.start=c.noteOn,c.stop=c.noteOff);c.buffer=
this._buffer;c.onended=this._onAudioEvent;this._gainNode.gain.value=this.muted?0:this.volume;c.connect(this._gainNode);c.start(0,this._offset);this._audioNode=c;this._startTime=this._context.currentTime;this.playing=!0},_clearAudioNode:function(){var c=this._audioNode;c&&(c.onended=null,c.disconnect(0),this._audioNode=null)},play:function(){this.playing&&this.stop();this.loaded?this._doPlay():this._buffer||(this.autoPlay=!0,this.load());return this},pause:function(){this.playing&&(this._audioNode.stop(0),
this._offset+=this._context.currentTime-this._startTime,this.playing=!1);return this},resume:function(){this.playing||this._doPlay();return this},stop:function(){this.playing&&(this._audioNode.stop(0),this._audioNode.disconnect(),this._offset=0,this.playing=!1);return this},setVolume:function(c){this.volume!=c&&(this.volume=c,this._gainNode.gain.value=c);return this},setMute:function(c){this.muted!=c&&(this.muted=c,this._gainNode.gain.value=c?0:this.volume);return this},Statics:{isSupported:null!=
a,enabled:!1,enable:function(){if(!this.enabled&&f){var c=f.createBufferSource();c.buffer=f.createBuffer(1,1,22050);c.connect(f.destination);c.start?c.start(0,0,0):c.noteOn(0,0,0);return this.enabled=!0}return this.enabled}}})}();g.WebAudio=a})(window);(function(h){var g=h.Hilo,e=g.HTMLAudio,b=g.WebAudio;g.WebSound={_audios:{},enableAudio:function(){b.isSupported&&b.enable()},getAudio:function(a){a=this._normalizeSource(a);var d=this._audios[a.src];d||(b.isSupported?d=new b(a):e.isSupported&&(d=new e(a)),this._audios[a.src]=d);return d},removeAudio:function(a){a="string"===typeof a?a:a.src;var d=this._audios[a];d&&(d.stop(),d.off(),this._audios[a]=null,delete this._audios[a])},_normalizeSource:function(a){var d={};"string"===typeof a?d={src:a}:
g.copy(d,a);return d}}})(window);(function(h){var g=h.Hilo;h=g.Class.create({constructor:function(e){e=e||{};g.copy(this,e,!0)},renderType:null,canvas:null,stage:null,startDraw:function(e){return!0},draw:function(e){},endDraw:function(e){},transform:function(){},clear:function(e,b,a,d){},resize:function(e,b){}});g.Renderer=h})(window);(function(h){var g=h.Hilo,e=g.Class,b=g.Renderer,a=g.Drawable,d=function(){return e.create({Extends:b,constructor:function(f){d.superclass.constructor.call(this,f)},renderType:"dom",startDraw:function(f){var c=f.drawable=f.drawable||new a;c.domElement=c.domElement||g.createElement("div",{style:{position:"absolute"}});return f.visible},draw:function(f){g.setElementStyleByView(f)},resize:function(f,c){var a=this.canvas.style;a.width=f+"px";a.height=c+"px";"absolute"!=a.position&&(a.position="relative")}})}();
g.DOMRenderer=d})(window);(function(h){h=h.Hilo;var g=h.Matrix,e=Math.PI/180,b=h.Class.create({Extends:h.Renderer,Statics:{MAX_BATCH_NUM:2E3,ATTRIBUTE_NUM:5,isSupport:null},renderType:"webgl",gl:null,constructor:function(f){b.superclass.constructor.call(this,f);f=this.gl=this.canvas.getContext("webgl",{stencil:!0})||this.canvas.getContext("experimental-webgl",{stencil:!0});f.blendFunc(f.ONE,f.ONE_MINUS_SRC_ALPHA);f.enable(f.BLEND);f.disable(f.CULL_FACE);f.disable(f.DEPTH_TEST);f.disable(f.STENCIL_TEST);this._initShaders();
this.vertex2=new Float32Array(8);this.indexs2=new Uint16Array([0,1,2,1,2,3]);this.notextureShader.active();f.bufferData(f.ELEMENT_ARRAY_BUFFER,this.indexs2,f.STATIC_DRAW);f.bufferData(f.ARRAY_BUFFER,this.vertex2,f.STREAM_DRAW);this.maxBatchNum=b.MAX_BATCH_NUM;this.positionStride=4*b.ATTRIBUTE_NUM;var c=6*this.maxBatchNum;this.vertex=new Float32Array(this.maxBatchNum*b.ATTRIBUTE_NUM*4);this.indexs=new Uint16Array(c);for(var a=0,d=0;a<c;a+=6,d+=4)this.indexs[a+0]=d+0,this.indexs[a+1]=d+1,this.indexs[a+
2]=d+2,this.indexs[a+3]=d+1,this.indexs[a+4]=d+2,this.indexs[a+5]=d+3;this.batchIndex=0;this.sprites=[];this.defaultShader.active();f.bufferData(f.ELEMENT_ARRAY_BUFFER,this.indexs,f.STATIC_DRAW);f.bufferData(f.ARRAY_BUFFER,this.vertex,f.STREAM_DRAW)},context:null,startDraw:function(f){return f.visible&&0<f.alpha?(f.__webglWorldMatrix=f.__webglWorldMatrix||new g(1,0,0,1,0,0),f.__webglRenderAlpha=f.__webglRenderAlpha||1,!0):!1},draw:function(f){var c=f.drawable,a=c&&c.image,d=f.background;(this.batchIndex>=
this.maxBatchNum||d)&&this._renderBatches();if(f.clipChildren){this.stencilLevel=this.stencilLevel||0;var b=this.gl;0===this.stencilLevel?(b.enable(b.STENCIL_TEST),b.clear(b.STENCIL_BUFFER_BIT),b.stencilFunc(b.ALWAYS,1,255),b.stencilOp(b.KEEP,b.REPLACE,b.REPLACE)):b.stencilOp(b.KEEP,b.INCR,b.INCR);b.colorMask(!1,!1,!1,!1);this.notextureShader.active();this._renderBackground(f,{r:1,g:1,b:1});this.stencilLevel+=1;b.colorMask(!0,!0,!0,!0);b.stencilFunc(b.LEQUAL,this.stencilLevel,255);b.stencilOp(b.KEEP,
b.KEEP,b.KEEP)}d&&(this.notextureShader.active(),this._renderBackground(f,d.toColorRgb()));a&&(this.defaultShader.active(),this._renderImage(f,a,c.rect))},endDraw:function(f){f===this.stage&&this._renderBatches();f.clipChildren&&(f=this.gl,--this.stencilLevel,f.stencilFunc(f.LEQUAL,this.stencilLevel,255),0==this.stencilLevel&&(this._renderBatches(),f.disable(this.gl.STENCIL_TEST)))},transform:function(f){this._setConcatenatedMatrix(f,f.parent);0<f.alpha&&(f.__webglRenderAlpha=f.parent&&f.parent.__webglRenderAlpha?
f.alpha*f.parent.__webglRenderAlpha:f.alpha)},clear:function(f,c,a,d){this.gl.clear(this.gl.COLOR_BUFFER_BIT)},resize:function(f,c){if(this.width!==f||this.height!==c)this.width=this.canvas.width=f,this.height=this.canvas.height=c,this.gl.viewport(0,0,f,c),this.activeShader.active(!0)},_renderBackground:function(f,c){var a=this.gl,d=f.__webglRenderAlpha;a.uniform4f(this.activeShader.u_color,c.r/255*d,c.g/255*d,c.b/255*d,d);var b=f.width,e=f.height,d=-f.pivotX,g=f.pivotY-e,h=this.vertex2;h[0]=d;h[1]=
g;h[2]=d+b;h[3]=g;h[4]=d;h[5]=g+e;h[6]=d+b;h[7]=g+e;b=f.__webglWorldMatrix;for(e=0;4>e;e++)d=h[2*e],g=h[2*e+1],h[2*e]=b.a*d+b.c*g+b.tx,h[2*e+1]=b.b*d+b.d*g+b.ty;a.bufferData(a.ARRAY_BUFFER,h,a.STREAM_DRAW);a.drawElements(a.TRIANGLES,6,a.UNSIGNED_SHORT,0)},_renderImage:function(f,c,a){c.texture||this.activeShader.uploadTexture(c);var d=this._createVertexs(c,a[0],a[1],a[2],a[3],-f.pivotX,-f.pivotY,f.width,f.height);a=this.batchIndex*this.positionStride;var b=this.vertex,e=f.__webglRenderAlpha;b[a+0]=
d[0];b[a+1]=d[1];b[a+2]=d[2];b[a+3]=d[3];b[a+4]=e;b[a+5]=d[4];b[a+6]=d[5];b[a+7]=d[6];b[a+8]=d[7];b[a+9]=e;b[a+10]=d[8];b[a+11]=d[9];b[a+12]=d[10];b[a+13]=d[11];b[a+14]=e;b[a+15]=d[12];b[a+16]=d[13];b[a+17]=d[14];b[a+18]=d[15];b[a+19]=e;d=f.__webglWorldMatrix;for(e=0;4>e;e++){var g=b[a+5*e],h=b[a+5*e+1];b[a+5*e]=d.a*g+d.c*h+d.tx;b[a+5*e+1]=d.b*g+d.d*h+d.ty}f.texture=c.texture;this.sprites[this.batchIndex++]=f},_renderBatches:function(){var a=this.gl;a.bufferSubData(a.ARRAY_BUFFER,0,this.vertex.subarray(0,
this.batchIndex*this.positionStride));for(var a=0,c=null,d=0;d<this.batchIndex;d++){var b=this.sprites[d];c&&c!==b.texture&&(this._renderBatch(a,d),a=d);c=b.texture}this._renderBatch(a,this.batchIndex);this.batchIndex=0},_renderBatch:function(a,c){var d=this.gl,b=c-a;0<b&&(d.bindTexture(d.TEXTURE_2D,this.sprites[a].texture),d.drawElements(d.TRIANGLES,6*b,d.UNSIGNED_SHORT,12*a))},_initShaders:function(){this.defaultShader=new d(this,{v:"attribute vec2 a_position;\nattribute vec2 a_TexCoord;\nattribute float a_alpha;\nuniform mat3 u_projectionTransform;\nvarying vec2 v_TexCoord;\nvarying float v_alpha;\nvoid main(){\n    gl_Position =  vec4((u_projectionTransform * vec3(a_position, 1.0)).xy, 1.0, 1.0);\n    v_TexCoord = a_TexCoord;\n    v_alpha = a_alpha;\n}\n",
f:"\nprecision mediump float;\nuniform sampler2D u_Sampler;\nvarying vec2 v_TexCoord;\nvarying float v_alpha;\nvoid main(){\n    gl_FragColor = texture2D(u_Sampler, v_TexCoord) * v_alpha;\n}\n"},{attributes:[{name:"a_position",count:2,offset:0,stride:20},{name:"a_TexCoord",count:2,offset:8,stride:20},{name:"a_alpha",count:1,offset:16,stride:20}],uniforms:["u_projectionTransform","u_Sampler"]});this.notextureShader=new d(this,{v:"attribute vec2 a_position;\nuniform mat3 u_projectionTransform;\nvoid main(){\n    gl_Position =  vec4((u_projectionTransform * vec3(a_position, 1.0)).xy, 1.0, 1.0);\n}\n",
f:"\nprecision mediump float;\nuniform vec4 u_color;\nvoid main(){\n    gl_FragColor = u_color;\n}\n"},{attributes:[{name:"a_position",count:2,offset:0,stride:8}],uniforms:["u_projectionTransform","u_color"]})},_createVertexs:function(a,c,d,b,e,g,h,n,q){var l=this.__tempVertexs||[],p=a.width;a=a.height;b/=p;e/=a;c/=p;d/=a;1<b+c&&(b=1-c);1<e+d&&(e=1-d);d=1-d-e;h=-q-h;p=0;l[p++]=g;l[p++]=h;l[p++]=c;l[p++]=d;l[p++]=g+n;l[p++]=h;l[p++]=c+b;l[p++]=d;l[p++]=g;l[p++]=h+q;l[p++]=c;l[p++]=d+e;l[p++]=g+n;l[p++]=
h+q;l[p++]=c+b;l[p++]=d+e;return l},_setConcatenatedMatrix:function(a,c){var d=a.__webglWorldMatrix,b=1,g=0,h=360-a.rotation%360,u=a.scaleX,n=a.scaleY;h&&(g=h*e,b=Math.cos(g),g=Math.sin(g));d.a=b*u;d.b=g*u;d.c=-g*n;d.d=b*n;d.tx=a.x;d.ty=-a.y;b=c.__webglWorldMatrix;d.concat(b.a,b.b,b.c,b.d,b.tx,b.ty)}}),a={},d=function(a,c,d){this.renderer=a;this.gl=a.gl;this.program=this._createProgram(this.gl,c.v,c.f);d=d||{};this.attributes=d.attributes||[];this.uniforms=d.uniforms||[];this.vertexBuffer=this.gl.createBuffer();
this.indexBuffer=this.gl.createBuffer()};d.prototype={active:function(a){var c=this,d=c.renderer,b=d.activeShader;if(b!==c||a){var e=c.gl,g=c.program;g&&e&&(b&&b.attributes.forEach(function(a){e.disableVertexAttribArray(b[a.name])}),d.activeShader=c,e.useProgram(g),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,c.indexBuffer),e.bindBuffer(e.ARRAY_BUFFER,c.vertexBuffer),c.attributes.forEach(function(a){attribute=a.name;c[attribute]=c[attribute]||e.getAttribLocation(g,attribute);e.enableVertexAttribArray(c[attribute]);
e.vertexAttribPointer(c[attribute],a.count,e.FLOAT,!1,a.stride,a.offset)}),c.uniforms.forEach(function(a){c[a]=c[a]||e.getUniformLocation(g,a)}),c.width!==d.width||c.height!==d.height)&&(c.width=d.width,c.height=d.height,c.uploadProjectionTransform(!0))}},uploadTexture:function(f){var c=this.gl;if(a[f.src])f.texture=a[f.src];else{var d=c.createTexture();c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,d);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,1);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);
c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,f);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.uniform1i(this.u_Sampler,0);c.bindTexture(c.TEXTURE_2D,null);f.texture=d;a[f.src]=d}},uploadProjectionTransform:function(a){var c=this.gl;if(!this._projectionTransformElements||a)this._projectionTransformElements=
new Float32Array([2/this.width,0,0,0,2/this.height,0,-1,1,1]);c.uniformMatrix3fv(this.u_projectionTransform,!1,this._projectionTransformElements)},_createProgram:function(a,c,d){c=this._createShader(a,a.VERTEX_SHADER,c);var b=this._createShader(a,a.FRAGMENT_SHADER,d);if(!c||!b)return null;if(d=a.createProgram())if(a.attachShader(d,c),a.attachShader(d,b),a.linkProgram(d),a.deleteShader(b),a.deleteShader(c),!a.getProgramParameter(d,a.LINK_STATUS))return c=a.getProgramInfoLog(d),console.log("Failed to link program: "+
c),a.deleteProgram(d),null;return d},_createShader:function(a,c,d){if(c=a.createShader(c))if(a.shaderSource(c,d),a.compileShader(c),!a.getShaderParameter(c,a.COMPILE_STATUS))return d=a.getShaderInfoLog(c),console.log("Failed to compile shader: "+d),a.deleteShader(c),null;return c}};b.isSupport=function(){if(void 0===this._isSupport){var a=document.createElement("canvas");a.getContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))?this._isSupport=!0:this._isSupport=!1}return this._isSupport};
h.WebGLRenderer=b})(window);(function(h){h=h.Hilo;var g=h.Class.create({Extends:h.Renderer,constructor:function(e){g.superclass.constructor.call(this,e);this.context=this.canvas.getContext("2d")},renderType:"canvas",context:null,startDraw:function(e){return e.visible&&0<e.alpha?(this.context.save(),!0):!1},draw:function(e){var b=this.context,a=e.width,d=e.height;e.clipChildren&&(b.beginPath(),b.rect(0,0,a,d),b.clip());var f=e.background;f&&(b.fillStyle=f,b.fillRect(0,0,a,d));if(e=(f=e.drawable)&&f.image)f=f.rect,b.drawImage(e,
f[0],f[1],f[2],f[3],0,0,a,d)},endDraw:function(e){this.context.restore()},transform:function(e){var b=this.context,a=e.x,d=e.y,f=e.scaleX,c=e.scaleY,k=e.pivotX,g=e.pivotY,h=e.rotation%360,v=e.align;if(v)if("function"===typeof v)e.align();else{var u=e.parent;if(u){var n=e.width,q=e.height,l=u.width,u=u.height;switch(v){case "TL":d=a=0;break;case "T":a=l-n>>1;d=0;break;case "TR":a=l-n;d=0;break;case "L":a=0;d=u-q>>1;break;case "C":a=l-n>>1;d=u-q>>1;break;case "R":a=l-n;d=u-q>>1;break;case "BL":a=0;
d=u-q;break;case "B":a=l-n>>1;d=u-q;break;case "BR":a=l-n,d=u-q}}}0==a&&0==d||b.translate(a,d);0!=h&&b.rotate(h*Math.PI/180);1==f&&1==c||b.scale(f,c);0==k&&0==g||b.translate(-k,-g);0<e.alpha&&(b.globalAlpha*=e.alpha)},clear:function(e,b,a,d){this.context.clearRect(e,b,a,d)},resize:function(e,b){this.canvas.width=e;this.canvas.height=b}});h.CanvasRenderer=g})(window);(function(h){var g=h.Hilo,e=g.Class,b=g.Event,a=g.Matrix;h=function(){function d(a,c,d){for(var b=a.length,e=c.length,g,h,n,q,l,p,r=0,w=g=0;w<b;w++){g=a[w];h=a[w<b-1?w+1:0];r=g.y-h.y;g=h.x-g.x;h=Math.sqrt(r*r+g*g);r/=h;g/=h;h=n=a[0].x*r+a[0].y*g;for(var x=1;x<b;x++)p=a[x].x*r+a[x].y*g,p>n?n=p:p<h&&(h=p);q=l=c[0].x*r+c[0].y*g;for(x=1;x<e;x++)p=c[x].x*r+c[x].y*g,p>l?l=p:p<q&&(q=p);h<q?(h=q-n,r=-r,g=-g):h-=l;if(0<=h)return!1;h>d.overlap&&(d.overlap=h,d.normal.x=r,d.normal.y=g)}return d}return e.create({Mixes:b,
constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("View");g.copy(this,a,!0)},id:null,x:0,y:0,width:0,height:0,alpha:1,rotation:0,visible:!0,pivotX:0,pivotY:0,scaleX:1,scaleY:1,pointerEnabled:!0,background:null,align:null,drawable:null,boundsArea:null,parent:null,depth:-1,getStage:function(){for(var a=this,c;c=a.parent;)a=c;return a.canvas&&a.renderer?a:null},getScaledWidth:function(){return this.width*this.scaleX},getScaledHeight:function(){return this.height*this.scaleY},addTo:function(a,
c){"number"===typeof c?a.addChildAt(this,c):a.addChild(this);return this},removeFromParent:function(){var a=this.parent;a&&a.removeChild(this);return this},fixSize:function(){if(!this.width||!this.height){var a=this.drawable&&this.drawable.rect;a&&(this.width=a[2],this.height=a[3])}},getBounds:function(){for(var a=this.width,c=this.height,d=this.getConcatenatedMatrix(),a=this.boundsArea||[{x:0,y:0},{x:a,y:0},{x:a,y:c},{x:0,y:c}],c=[],b,e,g,h,n,q,l,p=0,r=a.length;p<r;p++)b=d.transformPoint(a[p],!0,
!0),e=b.x,g=b.y,0==p?(h=n=e,q=l=g):(h>e?h=e:n<e&&(n=e),q>g?q=g:l<g&&(l=g)),c[p]=b;c.x=h;c.y=q;c.width=n-h;c.height=l-q;return c},getConcatenatedMatrix:function(f){for(var c=new a(1,0,0,1,0,0),d=this;d!=f&&d.parent;d=d.parent){var b=1,e=0,g=d.rotation%360,h=d.pivotX,n=d.pivotY,q=d.scaleX,l=d.scaleY;g&&(e=g*Math.PI/180,b=Math.cos(e),e=Math.sin(e));0!=h&&(c.tx-=h);0!=n&&(c.ty-=n);c.concat(b*q,e*q,-e*l,b*l,d.x,d.y)}return c},hitTestPoint:function(a,c,d){var b=this.getBounds(),e=a>=b.x&&a<=b.x+b.width&&
c>=b.y&&c<=b.y+b.height;if(e&&d){d=0;for(var e=!1,g,h,n,q,l=0,p=b.length;l<p;l++){var r=b[l],w=b[(l+1)%p];if(r.y==w.y&&c==r.y&&(r.x>w.x?(g=w.x,h=r.x):(g=r.x,h=w.x),a>=g&&a<=h)){e=!0;continue}r.y>w.y?(n=w.y,q=r.y):(n=r.y,q=w.y);if(!(c<n||c>q)){var x=(c-r.y)*(w.x-r.x)/(w.y-r.y)+r.x;x>a?d++:x==a&&(e=!0);r.x>a&&r.y==c&&(r=b[(p+l-1)%p],(r.y<c&&w.y>c||r.y>c&&w.y<c)&&d++)}}e=e||1==d%2}return e},hitTestObject:function(a,c){var b=this.getBounds(),e=a.getBounds(),g=b.x<=e.x+e.width&&e.x<=b.x+b.width&&b.y<=
e.y+e.height&&e.y<=b.y+b.height;g&&c&&(g=(g=d(b,e,{overlap:-Infinity,normal:{x:0,y:0}}))?d(e,b,g):!1);return!!g},_render:function(a,c){this.onUpdate&&!1===this.onUpdate(c)||!a.startDraw(this)||(a.transform(this),this.render(a,c),a.endDraw(this))},_fireMouseEvent:function(a){a.eventCurrentTarget=this;this.fire(a);if("mousemove"==a.type){if(!this.__mouseOver){this.__mouseOver=!0;var c=g.copy({},a);c.type="mouseover";this.fire(c)}}else"mouseout"==a.type&&(this.__mouseOver=!1);c=this.parent;a._stopped||
a._stopPropagationed||!c||("mouseout"==a.type||"touchout"==a.type?c.hitTestPoint(a.stageX,a.stageY,!0)||c._fireMouseEvent(a):c._fireMouseEvent(a))},onUpdate:null,render:function(a,c){this.fixSize();a.draw(this)},toString:function(){for(var a,c=this;c;)a=a?c.id+"."+a:c.id,c=c.parent;return a}})}();g.View=h})(window);(function(h){var g=h.Hilo,e=g.Drawable,b=g.Class.create({Extends:g.View,constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("Container");b.superclass.constructor.call(this,a);this.children?this._updateChildren():this.children=[]},children:null,pointerChildren:!0,clipChildren:!1,getChildrenNum:function(){return this.children.length},addChildAt:function(a,d){var f=this.children,c=f.length,b=a.parent;d=0>d?0:d>c?c:d;var e=this.getChildIndex(a);if(e==d)return this;0<=e?(f.splice(e,1),d=d==
c?c-1:d):b&&b.removeChild(a);f.splice(d,0,a);0>e?this._updateChildren(d):this._updateChildren(e<d?e:d,(e<d?d:e)+1);a.drawable&&a.drawable.domElement&&(this._domContainerFlag=!0);return this},addChild:function(a){for(var d=this.children.length,f=arguments,c=0,b=f.length;c<b;c++)this.addChildAt(f[c],d+c);return this},removeChildAt:function(a){var d=this.children;if(0>a||a>=d.length)return null;var f=d[a];if(f){var c=f.drawable,b=c&&c.domElement;if(b){var e=b.parentNode;e&&e.removeChild(b);c.domElement=
null;this._domContainerFlag=!0}f.parent=null;f.depth=-1}d.splice(a,1);this._updateChildren(a);return f},removeChild:function(a){return this.removeChildAt(this.getChildIndex(a))},removeChildById:function(a){for(var d=this.children,f,c=0,b=d.length;c<b;c++)if(f=d[c],f.id===a)return this.removeChildAt(c),f;return null},removeAllChildren:function(){for(;this.children.length;)this.removeChildAt(0);return this},getChildAt:function(a){var d=this.children;return 0>a||a>=d.length?null:d[a]},getChildById:function(a){for(var d=
this.children,f,c=0,b=d.length;c<b;c++)if(f=d[c],f.id===a)return f;return null},getChildIndex:function(a){return this.children.indexOf(a)},setChildIndex:function(a,d){var f=this.children,c=f.indexOf(a);if(0<=c&&c!=d){var b=f.length;d=0>d?0:d>=b?b-1:d;f.splice(c,1);f.splice(d,0,a);this._updateChildren()}return this},swapChildren:function(a,d){var f=this.children,c=this.getChildIndex(a),b=this.getChildIndex(d);a.depth=b;f[b]=a;d.depth=c;f[c]=d},swapChildrenAt:function(a,d){var f=this.children,c=this.getChildAt(a),
b=this.getChildAt(d);c.depth=d;f[d]=c;b.depth=a;f[a]=b},sortChildren:function(a){var d=this.children;if("string"==typeof a){var b=a;a=function(a,d){return d[b]-a[b]}}d.sort(a);this._updateChildren()},_updateChildren:function(a,d){var b=this.children,c;d=d||b.length;for(var e=a||0;e<d;e++)c=b[e],c.depth=e+1,c.parent=this},contains:function(a){for(;a=a.parent;)if(a===this)return!0;return!1},getViewAtPoint:function(a,d,b,c,e){if(this.clipChildren&&!this.hitTestPoint(a,d,b))return null;for(var g=c?[]:
null,h=this.children,v,u,n=h.length-1;0<=n;n--)if(v=h[n],!(!v||!v.visible||0>=v.alpha||e&&!v.pointerEnabled))if(v.children&&v.children.length&&(!e||v.pointerChildren)&&(u=v.getViewAtPoint(a,d,b,c,e)),u)if(c)u.length&&(g=g.concat(u));else return u;else if(v.hitTestPoint(a,d,b))if(c)g.push(v);else return v;return c&&g.length?g:null},render:function(a,d){b.superclass.render.call(this,a,d);"dom"!=a.renderType&&(this._domContainerFlag&&(this._domContainerFlag=!1,this._domContainerUpdate()),this.drawable&&
this.drawable.domElement&&g.setElementStyleByView(this,!0));var f=this.children.slice(0),c,e,h;c=0;for(e=f.length;c<e;c++)h=f[c],h._render(a,d)},_domContainerUpdate:function(){var a=this.children,d=!1;i=0;for(len=a.length;i<len;i++)if(child=a[i],child.drawable&&child.drawable.domElement){d=!0;break}var a=this.parent,b=this.drawable,c=b&&b.domElement;d?c||(b=this.drawable=this.drawable||new e,b.domElement=b.domElement||g.createElement("div",{style:{position:"absolute"}}),a&&a._domContainerUpdate()):
c&&(c&&((d=c.parentNode)&&d.removeChild(c),this.drawable=b.domElement=null),a&&a._domContainerUpdate())}});g.Container=b})(window);(function(h){var g=h.Hilo,e=g.CanvasRenderer,b=g.DOMRenderer,a=g.WebGLRenderer,d=g.Class.create({Extends:g.Container,constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("Stage");d.superclass.constructor.call(this,a);this._initRenderer(a);var c=this.width,b=this.height,e=this.updateViewport();a.width||(c=e&&e.width||320);a.height||(b=e&&e.height||480);this.resize(c,b,!0)},canvas:null,renderer:null,paused:!1,viewport:null,_initRenderer:function(d){var c=d.canvas,h=d.container;d=d.renderType||
"canvas";"string"===typeof c&&(c=g.getElement(c));"string"===typeof h&&(h=g.getElement(h));c||(c=g.createElement("dom"===d?"div":"canvas",{style:{position:"absolute",overflow:"hidden"}}));this.canvas=c;h&&h.appendChild(c);c={canvas:c,stage:this};switch(d){case "dom":this.renderer=new b(c);break;case "webgl":a.isSupport()?this.renderer=new a(c):this.renderer=new e(c);break;default:this.renderer=new e(c)}},_render:function(a,c){if((!this.onUpdate||!1!==this.onUpdate(c))&&a.startDraw(this)){var d=this.width,
b=this.height,e=this.scaleX,g=this.scaleY,h=this._height,n=this._scaleX,q=this._scaleY,l=this.canvas,p=l.style;if(this._width!==d||n!==e)this._width=d,this._scaleX=e,l.width=d,p.width=e*d+"px";if(h!==b||q!==g)this._height=b,this._scaleY=g,l.height=b,p.height=g*b+"px";(d=this.drawable&&this.drawable.domElement)&&!d.parentNode&&(d.style.overflow="hidden",l.appendChild(d));a.clear(0,0,this.width,this.height);this.render(a,c);a.endDraw(this)}},addTo:function(a){var c=this.canvas;c.parentNode!==a&&a.appendChild(c);
return this},tick:function(a){this.paused||this._render(this.renderer,a)},resize:function(a,c,d){if(d||this.width!==a||this.height!==c)this.width=a,this.height=c,this.renderer.resize(a,c),this.updateViewport()},updateViewport:function(){var a=this.canvas,c=null;a.parentNode&&(c=this.viewport=g.getElementRect(a));return c},enableDOMEvent:function(a,c){var d=this,b=d.canvas,e="string"===typeof a?[a]:a;c=!1!==c;for(var g=d._domListener||(d._domListener=function(a){d._onDOMEvent(a)}),h=0;h<e.length;h++)a=
e[h],c?b.addEventListener(a,g,!1):b.removeEventListener(a,g);return d},_onDOMEvent:function(a){var c=a.type,d=0==c.indexOf("touch"),b=a;if(d)var e=a.touches,b=a.changedTouches,b=e&&e.length?e[0]:b&&b.length?b[0]:null;var e=b.pageX||b.clientX,b=b.pageY||b.clientY,h=this.viewport||this.updateViewport();a.stageX=e=(e-h.left)/this.scaleX;a.stageY=b=(b-h.top)/this.scaleY;a.stopPropagation=function(){this._stopPropagationed=!0};var e=this.getViewAtPoint(e,b,!0,!1,!0)||this,b=this.canvas,h=this._eventTarget,
u="mouseout"===c;if(h&&(!(h==e||h.contains&&h.contains(e))||u)){if(u="touchmove"===c?"touchout":"mousemove"===c||u||!e?"mouseout":null){var n=g.copy({},a);n.type=u;n.eventTarget=h;h._fireMouseEvent(n)}a.lastEventTarget=h;this._eventTarget=null}e&&e.pointerEnabled&&"mouseout"!==c&&(a.eventTarget=this._eventTarget=e,e._fireMouseEvent(a));d||(b.style.cursor=e&&e.pointerEnabled&&e.useHandCursor?"pointer":"");g.browser.android&&"touchmove"===c&&a.preventDefault()},_domContainerUpdate:function(){d.superclass._domContainerUpdate.call(this);
var a=this.drawable&&this.drawable.domElement;a&&!a.parentNode&&this.canvas.parentNode&&this.canvas.parentNode.appendChild(a)}});g.Stage=d})(window);(function(h){var g=h.Hilo,e=g.Drawable,b=g.Class.create({Extends:g.View,constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("Bitmap");b.superclass.constructor.call(this,a);this.drawable=new e(a);if(!this.width||!this.height)if(a=this.drawable.rect)this.width=a[2],this.height=a[3]},setImage:function(a,d){this.drawable.init({image:a,rect:d});d&&(this.width=d[2],this.height=d[3]);return this}});g.Bitmap=b})(window);(function(h){var g=h.Hilo,e=g.Drawable,b=g.Class.create({Extends:g.View,constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("Sprite");b.superclass.constructor.call(this,a);this._frames=[];this._frameNames={};this._frameCallbacks=[];this.drawable=new e;a.frames&&this.setFrames(a.frames)},_frames:null,_frameNames:null,_frameIndex:0,_framePaused:!1,_frameElapsed:0,_frameCallbacks:null,loop:!0,duration:1,setFrames:function(a){if(a instanceof Array){this._frames=a;this._frameNames={};for(var d=
0,b=a.length;d<b;d++){var c=a[d];c.name&&(this._frameNames[c.name]=c)}}else{var b=a.image,d=a.rect||[0,0,b.width,b.height],c=d[0],e=d[1],g=a.width||d[2],h=a.height||d[3],v=Math.floor(d[2]/g);a=a.total||v*Math.floor(d[3]/h);for(var u=[],d=0;d<a;d++)u[d]={image:b,rect:[c+d%v*g,e+h*Math.floor(d/v),g,h]};this.setFrames(u)}return this},getFrame:function(a){if("number"===typeof a){var b=this._frames;return 0>a||a>=b.length?null:b[a]}return this._frameNames[a]},getFrameIndex:function(a){if(null==a||void 0==
a)return this._frameIndex;var b=this._frames,e=b.length,c=-1;if("number"===typeof a)c=a;else if(a="string"===typeof a?this._frameNames[a]:a)for(var g=0;g<e;g++)if(a===b[g]){c=g;break}return c},getFrameTotal:function(){return this._frames?this._frames.length:0},setFrameCallback:function(a,b){var e=this.getFrameIndex(a);-1<e&&(this._frameCallbacks[e]=b);return this},play:function(){this._framePaused=!1;return this},stop:function(){this._framePaused=!0;return this},"goto":function(a,b){var e=this._frames.length,
c=this.getFrameIndex(a);this._frameIndex=0>c?0:c>=e?e-1:c;this._framePaused=b||this._framePaused;this._frameElapsed=0;return this},_render:function(a,d){var e=this._nextFrame(d);if(e!=this._frameIndex){this._frameIndex=e;var c=this._frameCallbacks[e];c&&c.call(this);e=this._frames[e];this.drawable.init(e);this.width=e.rect[2];this.height=e.rect[3]}b.superclass._render.call(this,a,d)},_nextFrame:function(a){var b=this._frameIndex;if(this._framePaused)return b;var e=this._frames,c=e.length,e=e[b];if(e.stop||
!this.loop&&b>=c-1)return this.stop(),b;a=this._frameElapsed+a;var g=e.duration||this.duration;a>g?(this._frameElapsed=a-g,null!=e.next?b=this.getFrameIndex(e.next):b>=c-1?b=0:b++):this._frameElapsed=a;return b}});g.Sprite=b})(window);(function(h){var g=h.Hilo,e=g.Drawable,b=g.Class.create({Extends:g.View,constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("Button");b.superclass.constructor.call(this,a);this.drawable=new e(a);this.setState(b.UP)},upState:null,overState:null,downState:null,disabledState:null,state:null,enabled:!0,useHandCursor:!0,setEnabled:function(a){this.enabled!=a&&(a?this.setState(b.UP):this.setState(b.DISABLED));return this},setState:function(a){if(this.state!==a){this.state=a;this.pointerEnabled=
this.enabled=a!==b.DISABLED;var d;switch(a){case b.UP:d=this.upState;break;case b.OVER:d=this.overState;break;case b.DOWN:d=this.downState;break;case b.DISABLED:d=this.disabledState}d&&(this.drawable.init(d),g.copy(this,d,!0))}return this},fire:function(a,d){if(this.enabled){switch("string"===typeof a?a:a.type){case "mousedown":case "touchstart":case "touchmove":this.setState(b.DOWN);break;case "mouseover":this.setState(b.OVER);break;case "mouseup":this.overState?this.setState(b.OVER):this.upState&&
this.setState(b.UP);break;case "touchend":case "touchout":case "mouseout":this.setState(b.UP)}return b.superclass.fire.call(this,a,d)}},Statics:{UP:"up",OVER:"over",DOWN:"down",DISABLED:"disabled"}});g.Button=b})(window);(function(h){var g=h.Hilo;h=g.Class;var e=g.Drawable,b=g.View,a=g.createElement("canvas"),d=a&&a.getContext("2d"),f=h.create({Extends:b,constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("Text");f.superclass.constructor.call(this,a);a.width?(this.width=a.width,this._autoWidth=!1):(this.width=256,this._autoWidth=!0);a.height?(this.height=a.height,this._autoHeight=!1):(this.height=256,this._autoHeight=!0);this.setFont(a.font||"16px arial")},text:null,color:"#000",textAlign:null,outline:!1,
lineSpacing:0,font:null,setFont:function(a){this.font!==a&&(this.font=a,this._fontHeight=f.measureFontHeight(a));return this},render:function(a,b){if("canvas"===a.renderType)this._draw(a.context);else if("dom"===a.renderType){var d=this.drawable.domElement,e=d.style;this._check()&&(e.font=this.font,e.textAlign=this.textAlign,e.color=this.color,e.lineHeight=this._fontHeight+this.lineSpacing+"px",e["word-break"]="break-all",e["word-wrap"]="break-word",d.innerHTML=this.text.replace("\n","</br>"));a.draw(this);
this._autoWidth?(this.width=d.offsetWidth,e.width=null):e.width=this.width+"px";this._autoHeight?(this.height=d.offsetHeight,e.height=null):e.height=this.height+"px"}else this._check()&&this._cache(),a.draw(this)},_draw:function(a){var b=this.text.toString();if(b){a.font=this.font;a.textAlign=this.textAlign;a.textBaseline="top";var e=b.split(/\r\n|\r|\n|<br(?:[ \/])*>/),f=0,g=0,h=this._fontHeight+this.lineSpacing,n,q,l,b=[];n=0;for(len=e.length;n<len;n++)if(q=e[n],l=a.measureText(q).width,l<=this.width||
this._autoWidth)b.push({text:q,y:g}),f<l&&(f=l),g+=h;else{l="";var p=0,r,w,x;w=0;for(wlen=q.length;w<wlen;w++)x=q[w],r=a.measureText(l+x).width,r>this.width?(b.push({text:l,y:g}),f<p&&(f=p),g+=h,l=x):(p=r,l+=x),w==wlen-1&&(b.push({text:l,y:g}),l!==x&&f<r&&(f=r),g+=h)}this._autoWidth&&(this.width=f);this._autoHeight&&(this.height=g);(e=this.background)&&a!==d&&(a.fillStyle=e,a.fillRect(0,0,this.width,this.height));this.outline?a.strokeStyle=this.color:a.fillStyle=this.color;for(n=0;n<b.length;n++)q=
b[n],this._drawTextLine(a,q.text,q.y)}},_drawTextLine:function(a,b,d){var e=0,f=this.width;switch(this.textAlign){case "center":e=f>>1;break;case "right":e=f}this.outline?a.strokeText(b,e,d):a.fillText(b,e,d)},_check:function(){var a=!0;this._text!==this.text&&(this._text=this.text,a=!0);this._color!==this.color&&(this._color=this.color,a=!0);this._font!==this.font&&(this._font=this.font,a=!0);return a},_cache:function(){a.width=this.width;a.height=this.height;d.clearRect(0,0,a.width,a.height);this._draw(d);
var c=new Image;c.src=a.toDataURL();this.drawable=this.drawable||new e;this.drawable.init(c)},Statics:{measureFontHeight:function(a){a=g.createElement("div",{style:{font:a,position:"absolute"},innerHTML:"PM\u56fd\u5bb6"});var b=document.documentElement;b.appendChild(a);var d=a.offsetHeight;b.removeChild(a);return d}}});g.Text=f})(window);(function(h){var g=h.Hilo,e=g.Bitmap,b=g.Class.create({Extends:g.Container,constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("Label");b.superclass.constructor.call(this,a);a.font&&this.setFont(a.font);if(a=a.text+"")this.text="",this.setText(a);this.pointerChildren=!1},glyphs:null,spacing:0,text:"",textAlign:"left",setFont:function(a){var b=a.text.toString(),e=a.image,c=a.rect||[0,0,e.width,e.height],g=a.width||c[2],h=a.height||c[3];a=a.col||Math.floor(c[2]/g);for(var c={},m=0,v=b.length;m<
v;m++)charStr=b.charAt(m),c[charStr]={image:e,rect:[m%a*g,h*Math.floor(m/a),g,h]};this.glyphs=c;""!=this.text&&(b=this.text,this.text="",this.setText(b))},setText:function(a){a=a.toString();var d=a.length;if(this.text!=a){this.text=a;var e,c,g,h=g=0,m=0;for(e=0;e<d;e++)if(c=a.charAt(e),c=this.glyphs[c])m=g+(0<g?this.spacing:0),this.children[e]?(g=this.children[e],g.setImage(c.image,c.rect)):(g=b._createBitmap(c),this.addChild(g)),g.x=m,g=m+c.rect[2],h=Math.max(h,c.rect[3]);for(e=this.children.length-
1;e>=d;e--)b._releaseBitmap(this.children[e]),this.removeChild(this.children[e]);this.width=g;this.height=h;this.setTextAlign();return this}},setTextAlign:function(a){this.textAlign=a||this.textAlign;switch(this.textAlign){case "center":this.pivotX=.5*this.width;break;case "right":this.pivotX=this.width;break;default:this.pivotX=0}return this},Statics:{_pool:[],_createBitmap:function(a){var d;0<b._pool.length?(d=b._pool.pop(),d.setImage(a.image,a.rect)):(d=new e({image:a.image,rect:a.rect}),console.log(a.image,
a.rect));return d},_releaseBitmap:function(a){b._pool.push(a)}}});g.Label=b})(window);(function(h){var g=h.Hilo,e=g.Drawable,b=g.Class.create({Extends:g.View,constructor:function(a){a=a||{};this.id=this.id||a.id||g.getUid("Element");b.superclass.constructor.call(this,a);this.drawable=new e;(this.drawable.domElement=a.element||g.createElement("div",{style:{position:"absolute"}})).id=this.id},_render:function(a,b){this.onUpdate&&!1===this.onUpdate(b)||this.visible&&this.render(a,b)},render:function(a,b){"dom"!=a.renderType?g.setElementStyleByView(this):a.draw(this)}});g.Element=b})(window);
