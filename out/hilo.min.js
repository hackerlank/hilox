(function(a){a.console=a.console||{log:function(){}};a=Array.prototype;var b=a.slice;a.indexOf=a.indexOf||function(g,c){c=c||0;var f=this.length,h;if(0==f||c>=f){return -1}0>c&&(c=f+c);for(h=c;h<f;h++){if(this[h]===g){return h}}return -1};a=Function.prototype;a.bind=a.bind||function(j){function c(){var d=k.concat(b.call(arguments));return g.apply(this instanceof c?this:j,d)}var g=this,k=b.call(arguments,1),h=function(){};h.prototype=g.prototype;c.prototype=new h;return c}})(window);(function(c){for(var d=0,f=["ms","moz","webkit","o"],a=0;a<f.length&&!c.requestAnimationFrame;++a){c.requestAnimationFrame=c[f[a]+"RequestAnimationFrame"],c.cancelAnimationFrame=c[f[a]+"CancelAnimationFrame"]||c[f[a]+"CancelRequestAnimationFrame"]}c.requestAnimationFrame||(c.requestAnimationFrame=function(b,h){var g=(new Date).getTime(),j=Math.max(0,16-(g-d)),e=c.setTimeout(function(){b(g+j)},j);d=g+j;return e});c.cancelAnimationFrame||(c.cancelAnimationFrame=function(b){clearTimeout(b)})})(window);(function(a){var b=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;String.prototype.toColorRgb=function(){var c=this.toLowerCase();return c&&b.test(c)?4===c.length?{r:parseInt("0x"+c.charAt(1)+c.charAt(1)),g:parseInt("0x"+c.charAt(2)+c.charAt(2)),b:parseInt("0x"+c.charAt(3)+c.charAt(3))}:{r:parseInt("0x"+c.slice(1,3)),g:parseInt("0x"+c.slice(3,5)),b:parseInt("0x"+c.slice(5,7))}:{r:0,g:0,b:0}}})(window);(function(a){var b=function(){var f=document,c=f.documentElement,d=0;return{getUid:function(g){var e=++d;return g?g+"_"+e:e},copy:function(e,h,j){for(var g in h){if(!j||e.hasOwnProperty(g)||void 0!==e[g]){e[g]=h[g]}}return e},browser:function(){var e=navigator.userAgent,e={iphone:/iphone/i.test(e),ipad:/ipad/i.test(e),ipod:/ipod/i.test(e),ios:/iphone|ipad|ipod/i.test(e),android:/android/i.test(e),webkit:/webkit/i.test(e),chrome:/chrome/i.test(e),safari:/safari/i.test(e),firefox:/firefox/i.test(e),ie:/msie/i.test(e),opera:/opera/i.test(e),supportTouch:"ontouchstart" in a,supportCanvas:null!=f.createElement("canvas").getContext,supportStorage:!1,supportOrientation:"orientation" in a,supportDeviceMotion:"ondevicemotion" in a};try{localStorage.setItem("hilo","hilo"),localStorage.removeItem("hilo"),e.supportStorage=!0}catch(g){}e.jsVendor=e.webkit?"webkit":e.firefox?"Moz":e.opera?"O":e.ie?"ms":"";e.cssVendor="-"+e.jsVendor+"-";return e}(),event:function(){var e="ontouchstart" in a;return{POINTER_START:e?"touchstart":"mousedown",POINTER_MOVE:e?"touchmove":"mousemove",POINTER_END:e?"touchend":"mouseup"}}(),align:{TOP_LEFT:"TL",TOP:"T",TOP_RIGHT:"TR",LEFT:"L",CENTER:"C",RIGHT:"R",BOTTOM_LEFT:"BL",BOTTOM:"B",BOTTOM_RIGHT:"BR"},getElement:function(e){return f.getElementById(e)},getElementRect:function(s){try{var p=s.getBoundingClientRect()}catch(q){p={top:s.offsetTop,left:s.offsetLeft,width:s.offsetWidth,height:s.offsetHeight}}var r=(a.pageXOffset||c.scrollLeft)-(c.clientLeft||0)||0,l=(a.pageYOffset||c.scrollTop)-(c.clientTop||0)||0,w=a.getComputedStyle?a.getComputedStyle(s):s.currentStyle,j=parseInt;s=j(w.paddingLeft)+j(w.borderLeftWidth)||0;var u=j(w.paddingTop)+j(w.borderTopWidth)||0,o=j(w.paddingRight)+j(w.borderRightWidth)||0,w=j(w.paddingBottom)+j(w.borderBottomWidth)||0,j=p.top||0,h=p.left||0;return{left:h+r+s,top:j+l+u,width:p.right-o-h-s,height:p.bottom-w-j-u}},createElement:function(g,l){var n=f.createElement(g),h,j,e;for(h in l){if(j=l[h],"style"===h){for(e in j){n.style[e]=j[e]}}else{n[h]=j}}return n},setElementStyleByView:function(j,o){var q=b.browser.jsVendor,l=!1,n=j.parent,h=j.drawable,l=h.domElement,g=l.style,p=j._stateCache||(j._stateCache={});n&&(n=n.drawable&&n.drawable.domElement)&&n!=l.parentNode&&n.appendChild(l);this.cacheStateIfChanged(j,["visible"],p)&&(g.display=j.visible?"":"none");this.cacheStateIfChanged(j,["alpha"],p)&&(g.opacity=j.alpha);if(j.visible&&!(0>=j.alpha)){this.cacheStateIfChanged(j,["width"],p)&&(g.width=(j.width||0)+"px");this.cacheStateIfChanged(j,["height"],p)&&(g.height=(j.height||0)+"px");this.cacheStateIfChanged(j,["depth"],p)&&(g.zIndex=j.depth+1);this.cacheStateIfChanged(j,["clipChildren"],p)&&(g.overflow=j.clipChildren?"hidden":null);if(l=this.cacheStateIfChanged(j,["pivotX","pivotY"],p)){g[q+"TransformOrigin"]=j.pivotX+"px "+j.pivotY+"px"}if(this.cacheStateIfChanged(j,["x","y","rotation","scaleX","scaleY"],p)||l){g[q+"Transform"]="translate("+(j.x-j.pivotX)+"px, "+(j.y-j.pivotY)+"px)rotate("+j.rotation+"deg)scale("+j.scaleX+", "+j.scaleY+")"}if(o){g.pointerEvents="none"}else{if(g.pointerEvents||(g.pointerEvents="none"),this.cacheStateIfChanged(j,["background"],p)&&(g.backgroundColor=j.background),q=h.image){if(q=q.src,q!==p.image&&(p.image=q,g.backgroundImage="url("+q+")"),q=h.rect){h=q[0],q=q[1],h!==p.sx&&(p.sx=h,g.backgroundPositionX=-h+"px"),q!==p.sy&&(p.sy=q,g.backgroundPositionY=-q+"px")}}}}},cacheStateIfChanged:function(j,o,q){var l,n,h,g,p=!1;l=0;for(n=o.length;l<n;l++){h=o[l],g=j[h],g!=q[h]&&(q[h]=g,p=!0)}return p}}}();a.Hilo=b})(window);(function(a){a=a.Hilo;var b=function(){var m=function(q){var k={},d,p;for(d in q){p=q[d],g.hasOwnProperty(d)?g[d].call(this,p):k[d]=p}n(this.prototype,k)},g={Extends:function(k){var e=this.prototype,d=h(k.prototype);n(this,k);n(d,e);d.constructor=this;this.prototype=d;this.superclass=k.prototype},Mixes:function(k){k instanceof Array||(k=[k]);for(var e=this.prototype,d;d=k.shift();){n(e,d.prototype||d)}},Statics:function(d){n(this,d)}},h=function(){if(Object.__proto__){return function(e){return{__proto__:e}}}var d=function(){};return function(c){d.prototype=c;return new d}}(),n=function(r){for(var k=1,t=arguments.length;k<t;k++){var c=arguments[k],s,q;for(q in c){var p=c[q];!p||"object"!==typeof p||void 0===p.value&&"function"!==typeof p.get&&"function"!==typeof p.set?r[q]=p:(s=s||{},s[q]=p)}s&&o(r,s)}return r};try{var l=Object.defineProperty,o=Object.defineProperties;l({},"$",{value:0})}catch(j){"__defineGetter__" in Object&&(l=function(k,e,d){"value" in d&&(k[e]=d.value);"get" in d&&k.__defineGetter__(e,d.get);"set" in d&&k.__defineSetter__(e,d.set);return k},o=function(f,d){for(var e in d){d.hasOwnProperty(e)&&l(f,e,d[e])}return f})}return{create:function(e){e=e||{};var d=e.hasOwnProperty("constructor")?e.constructor:function(){};m.call(d,e);return d},mix:n}}();a.Class=b})(window);(function(c){var d=c.Hilo,f=d.Class.create({constructor:function(b,g,e){this.type=b;this.target=g;this.detail=e;this.timeStamp=+new Date},type:null,target:null,detail:null,timeStamp:0,stopImmediatePropagation:function(){this._stopped=!0}});if(c=c.Event){c=c.prototype;var a=c.stopImmediatePropagation;c.stopImmediatePropagation=function(){a&&a.call(this);this._stopped=!0}}d.Event={_listeners:null,on:function(b,h,g){var j=this._listeners=this._listeners||{};b=j[b]=j[b]||[];for(var j=0,e=b.length;j<e;j++){if(b[j].listener===h){return}}b.push({listener:h,once:g});return this},off:function(b,h){if(0==arguments.length){return this._listeners=null,this}var g=this._listeners&&this._listeners[b];if(g){if(1==arguments.length){return delete this._listeners[b],this}for(var j=0,e=g.length;j<e;j++){if(g[j].listener===h){g.splice(j,1);0===g.length&&delete this._listeners[b];break}}}return this},fire:function(j,p){var o,q;"string"===typeof j?q=j:(o=j,q=j.type);var l=this._listeners;if(!l){return !1}var h=l[q];if(h){h=h.slice(0);o=o||new f(q,this,p);if(o._stopped){return !1}for(var e=0;e<h.length;e++){var n=h[e];n.listener.call(this,o);n.once&&h.splice(e--,1)}0==h.length&&delete l[q];return !0}return !1}}})(window);(function(a){a=a.Hilo;var b=a.Class.create({constructor:function(k,g,h,l,j,m){this.a=k;this.b=g;this.c=h;this.d=l;this.tx=j;this.ty=m},concat:function(v){var y=arguments,z=this.a,w=this.b,u=this.c,x=this.d,p=this.tx,A=this.ty;if(6<=y.length){var o=y[0],s=y[1],r=y[2],l=y[3],j=y[4],y=y[5]}else{o=v.a,s=v.b,r=v.c,l=v.d,j=v.tx,y=v.ty}this.a=z*o+w*r;this.b=z*s+w*l;this.c=u*o+x*r;this.d=u*s+x*l;this.tx=p*o+A*r+j;this.ty=p*s+A*l+y;return this},rotate:function(n){var g=Math.sin(n);n=Math.cos(n);var h=this.a,o=this.b,m=this.c,p=this.d,j=this.tx,l=this.ty;this.a=h*n-o*g;this.b=h*g+o*n;this.c=m*n-p*g;this.d=m*g+p*n;this.tx=j*n-l*g;this.ty=j*g+l*n;return this},scale:function(d,c){this.a*=d;this.d*=c;this.c*=d;this.b*=c;this.tx*=d;this.ty*=c;return this},translate:function(d,c){this.tx+=d;this.ty+=c;return this},identity:function(){this.a=this.d=1;this.b=this.c=this.tx=this.ty=0;return this},invert:function(){var k=this.a,g=this.b,h=this.c,l=this.d,j=this.tx,m=k*l-g*h;this.a=l/m;this.b=-g/m;this.c=-h/m;this.d=k/m;this.tx=(h*this.ty-l*j)/m;this.ty=-(k*this.ty-g*j)/m;return this},transformPoint:function(j,c,g){var k=j.x*this.a+j.y*this.c+this.tx,h=j.x*this.b+j.y*this.d+this.ty;c&&(k=k+0.5>>0,h=h+0.5>>0);if(g){return{x:k,y:h}}j.x=k;j.y=h;return j}});a.Matrix=b})(window);(function(a){var b=a.Hilo,c=b.Class.create({constructor:function(d){this._targetFPS=d||30;this._interval=1000/this._targetFPS;this._tickers=[]},_paused:!1,_targetFPS:0,_interval:0,_intervalId:null,_tickers:null,_lastTime:0,_tickCount:0,_tickTime:0,_measuredFPS:0,start:function(e){if(!this._intervalId){this._lastTime=+new Date;var g=this,l=this._interval,j=a.requestAnimationFrame||a[b.browser.jsVendor+"RequestAnimationFrame"];if(e&&j){var m=function(){g._tick()},h=function(){g._intervalId=setTimeout(h,l);j(m)}}else{h=function(){g._intervalId=setTimeout(h,l);g._tick()}}h()}},stop:function(){clearTimeout(this._intervalId);this._intervalId=null;this._lastTime=0},pause:function(){this._paused=!0},resume:function(){this._paused=!1},_tick:function(){if(!this._paused){var e=+new Date,g=e-this._lastTime,j=this._tickers;++this._tickCount>=this._targetFPS?(this._measuredFPS=1000/(this._tickTime/this._tickCount)+0.5>>0,this._tickTime=this._tickCount=0):this._tickTime+=e-this._lastTime;this._lastTime=e;for(var e=0,h=j.length;e<h;e++){j[e].tick(g)}}},getMeasuredFPS:function(){return this._measuredFPS},addTick:function(d){if(!d||"function"!=typeof d.tick){throw Error("Ticker: The tick object must implement the tick method.")}this._tickers.push(d)},removeTick:function(d){var e=this._tickers;d=e.indexOf(d);0<=d&&e.splice(d,1)}});b.Ticker=c})(window);(function(a){var b=a.Hilo,c=b.Class.create({constructor:function(d){this.init(d)},image:null,rect:null,domElement:null,init:function(e){var g=this,j=g.image;c.isDrawable(e)?g.image=e:b.copy(g,e,!0);e=g.image;if("string"===typeof e){if(j&&e===j.getAttribute("src")){e=g.image=j}else{g.image=null;var h=new Image;h.onload=function(){h.onload=null;g.init(h)};h.src=e;return}}e&&!g.rect&&(g.rect=[0,0,e.width,e.height])},Statics:{isDrawable:function(d){if(!d||!d.tagName){return !1}d=d.tagName.toLowerCase();return"img"===d||"canvas"===d||"video"===d}}});b.Drawable=c})(window);(function(a){var b=a.Hilo,c=b.Class.create({load:function(e){var g=e.src,j="jsonp"==e.type;if(j){var h=e.callbackName||"callback",k=e.callback||"jsonp"+ ++c._count;a[k]||(a[k]=function(d){delete a[k]})}j&&(g+=(-1==g.indexOf("?")?"?":"&")+h+"="+k);e.noCache&&(g+=(-1==g.indexOf("?")?"?":"&")+"t="+ +new Date);j=document.createElement("script");j.type="text/javascript";j.async=!0;j.onload=this.onLoad.bind(this);j.onerror=this.onError.bind(this);j.src=g;e.id&&(j.id=e.id);document.getElementsByTagName("head")[0].appendChild(j)},onLoad:function(d){d=d.target;d.onload=d.onerror=null;return d},onError:function(d){var e=d.target;e.onload=e.onerror=null;return d},Statics:{_count:0}});b.ScriptLoader=c})(window);(function(a){var b=a.Hilo,c=b.Class.create({load:function(e){var f=this,g=new Image;e.crossOrigin&&(g.crossOrigin=e.crossOrigin);g.onload=function(){f.onLoad(g)};g.onerror=g.onabort=f.onError.bind(g);g.src=e.src+(e.noCache?(-1==e.src.indexOf("?")?"?":"&")+"t="+ +new Date:"")},onLoad:function(d){d=d||a.event;d.onload=d.onerror=d.onabort=null;return d},onError:function(d){var e=d.target;e.onload=e.onerror=e.onabort=null;return d}});b.ImageLoader=c})(window);(function(c){c=c.Hilo;var d=c.ImageLoader,f=c.ScriptLoader,a=c.Class.create({Mixes:c.Event,constructor:function(b){this._source=[];this.add(b)},maxConnections:2,_source:null,_loaded:0,_connections:0,_currentIndex:-1,add:function(b){b&&(b=b instanceof Array?b:[b],this._source=this._source.concat(b));return this},get:function(b){if(b){for(var g=this._source,e=0;e<g.length;e++){var h=g[e];if(h.id===b||h.src===b){return h}}}return null},getContent:function(b){return(b=this.get(b))&&b.content},start:function(){this._loadNext();return this},_loadNext:function(){var h=this,n=h._source,l=n.length;if(h._loaded>=l){h.fire("complete")}else{if(h._currentIndex<l-1&&h._connections<h.maxConnections){var o=++h._currentIndex,n=n[o],j=h._getLoader(n);if(j){var g=j.onLoad,e=j.onError;j.onLoad=function(b){j.onLoad=g;j.onError=e;b=g&&g.call(j,b)||b.target;h._onItemLoad(o,b)};j.onError=function(b){j.onLoad=g;(j.onError=e)&&e.call(j,b);h._onItemError(o,b)};h._connections++}h._loadNext();j&&j.load(n)}}},_getLoader:function(b){var g=b.loader;if(g){return g}var e;if(!(e=b.type)){var h;if(b=b.src.match(/\/?[^/]+\.(\w+)(\?\S+)?$/i)){h=b[1].toLowerCase()}e=h||null}switch(e){case"png":case"jpg":case"jpeg":case"gif":g=new d;break;case"js":case"jsonp":g=new f}return g},_onItemLoad:function(b,g){var e=this._source[b];e.loaded=!0;e.content=g;this._connections--;this._loaded++;this.fire("load",e);this._loadNext()},_onItemError:function(b,g){var e=this._source[b];e.error=g;this._connections--;this._loaded++;this.fire("error",e);this._loadNext()},getSize:function(b){for(var h=0,g=this._source,j=0;j<g.length;j++){var e=g[j],h=h+((b?e.loaded&&e.size:e.size)||0)}return h},getLoaded:function(){return this._loaded},getTotal:function(){return this._source.length}});c.LoadQueue=a})(window);(function(a){var b=a.Hilo;a=b.Class.create({Mixes:b.Event,constructor:function(c){b.copy(this,c,!0);this._onAudioEvent=this._onAudioEvent.bind(this)},src:null,loop:!1,autoPlay:!1,loaded:!1,playing:!1,duration:0,volume:1,muted:!1,_element:null,load:function(){if(!this._element){try{var d=this._element=new Audio;d.addEventListener("canplaythrough",this._onAudioEvent,!1);d.addEventListener("ended",this._onAudioEvent,!1);d.addEventListener("error",this._onAudioEvent,!1);d.src=this.src;d.volume=this.volume;d.load()}catch(c){d=this._element={},d.play=d.pause=function(){}}}return this},_onAudioEvent:function(d){var c=d.type;switch(c){case"canplaythrough":d.target.removeEventListener(c,this._onAudioEvent);this.loaded=!0;this.duration=this._element.duration;this.fire("load");this.autoPlay&&this._doPlay();break;case"ended":this.playing=!1;this.fire("end");this.loop&&this._doPlay();break;case"error":this.fire("error")}},_doPlay:function(){this.playing||(this._element.volume=this.muted?0:this.volume,this._element.play(),this.playing=!0)},play:function(){this.playing&&this.stop();this._element?this.loaded&&this._doPlay():(this.autoPlay=!0,this.load());return this},pause:function(){this.playing&&(this._element.pause(),this.playing=!1);return this},resume:function(){this.playing||this._doPlay();return this},stop:function(){this.playing&&(this._element.pause(),this._element.currentTime=0,this.playing=!1);return this},setVolume:function(c){this.volume!=c&&(this.volume=c,this._element.volume=c);return this},setMute:function(c){this.muted!=c&&(this.muted=c,this._element.volume=c?0:this.volume);return this},Statics:{isSupported:null!==a.Audio}});b.HTMLAudio=a})(window);(function(f){var j=f.Hilo,k=j.Class,c=j.Event,d=function(){var b=f.AudioContext||f.webkitAudioContext,e=b?new b:null;return k.create({Mixes:c,constructor:function(a){j.copy(this,a,!0);this._init()},src:null,loop:!1,autoPlay:!1,loaded:!1,playing:!1,duration:0,volume:1,muted:!1,_context:null,_gainNode:null,_buffer:null,_audioNode:null,_startTime:0,_offset:0,_init:function(){this._context=e;this._gainNode=e.createGain?e.createGain():e.createGainNode();this._gainNode.connect(e.destination);this._onAudioEvent=this._onAudioEvent.bind(this);this._onDecodeComplete=this._onDecodeComplete.bind(this);this._onDecodeError=this._onDecodeError.bind(this)},load:function(){if(!this._buffer){var a=new XMLHttpRequest;a.src=this.src;a.open("GET",this.src,!0);a.responseType="arraybuffer";a.onload=this._onAudioEvent;a.onprogress=this._onAudioEvent;a.onerror=this._onAudioEvent;a.send();this._buffer=!0}return this},_onAudioEvent:function(a){switch(a.type){case"load":a=a.target;a.onload=a.onprogress=a.onerror=null;this._context.decodeAudioData(a.response,this._onDecodeComplete,this._onDecodeError);break;case"ended":this.playing=!1;this.fire("end");this.loop&&this._doPlay();break;case"progress":this.fire(a);break;case"error":this.fire(a)}},_onDecodeComplete:function(a){this._buffer=a;this.loaded=!0;this.duration=a.duration;this.fire("load");this.autoPlay&&this._doPlay()},_onDecodeError:function(){this.fire("error")},_doPlay:function(){this._clearAudioNode();var a=this._context.createBufferSource();a.start||(a.start=a.noteOn,a.stop=a.noteOff);a.buffer=this._buffer;a.onended=this._onAudioEvent;this._gainNode.gain.value=this.muted?0:this.volume;a.connect(this._gainNode);a.start(0,this._offset);this._audioNode=a;this._startTime=this._context.currentTime;this.playing=!0},_clearAudioNode:function(){var a=this._audioNode;a&&(a.onended=null,a.disconnect(0),this._audioNode=null)},play:function(){this.playing&&this.stop();this.loaded?this._doPlay():this._buffer||(this.autoPlay=!0,this.load());return this},pause:function(){this.playing&&(this._audioNode.stop(0),this._offset+=this._context.currentTime-this._startTime,this.playing=!1);return this},resume:function(){this.playing||this._doPlay();return this},stop:function(){this.playing&&(this._audioNode.stop(0),this._audioNode.disconnect(),this._offset=0,this.playing=!1);return this},setVolume:function(a){this.volume!=a&&(this.volume=a,this._gainNode.gain.value=a);return this},setMute:function(a){this.muted!=a&&(this.muted=a,this._gainNode.gain.value=a?0:this.volume);return this},Statics:{isSupported:null!=b,enabled:!1,enable:function(){if(!this.enabled&&e){var a=e.createBufferSource();a.buffer=e.createBuffer(1,1,22050);a.connect(e.destination);a.start?a.start(0,0,0):a.noteOn(0,0,0);return this.enabled=!0}return this.enabled}}})}();j.WebAudio=d})(window);(function(c){var d=c.Hilo,f=d.HTMLAudio,a=d.WebAudio;d.WebSound={_audios:{},enableAudio:function(){a.isSupported&&a.enable()},getAudio:function(b){b=this._normalizeSource(b);var e=this._audios[b.src];e||(a.isSupported?e=new a(b):f.isSupported&&(e=new f(b)),this._audios[b.src]=e);return e},removeAudio:function(b){b="string"===typeof b?b:b.src;var e=this._audios[b];e&&(e.stop(),e.off(),this._audios[b]=null,delete this._audios[b])},_normalizeSource:function(b){var e={};"string"===typeof b?e={src:b}:d.copy(e,b);return e}}})(window);(function(a){var b=a.Hilo;a=b.Class.create({constructor:function(c){c=c||{};b.copy(this,c,!0)},renderType:null,canvas:null,stage:null,startDraw:function(c){return !0},draw:function(c){},endDraw:function(c){},transform:function(){},clear:function(g,c,f,h){},resize:function(d,c){}});b.Renderer=a})(window);(function(j){var k=j.Hilo,l=k.Class,c=k.Renderer,f=k.Drawable,m=function(){return l.create({Extends:c,constructor:function(a){m.superclass.constructor.call(this,a)},renderType:"dom",startDraw:function(a){var b=a.drawable=a.drawable||new f;b.domElement=b.domElement||k.createElement("div",{style:{position:"absolute"}});return a.visible},draw:function(a){k.setElementStyleByView(a)},resize:function(d,e){var b=this.canvas.style;b.width=d+"px";b.height=e+"px";"absolute"!=b.position&&(b.position="relative")}})}();k.DOMRenderer=m})(window);(function(j){j=j.Hilo;var k=j.Matrix,l=Math.PI/180,c=j.Class.create({Extends:j.Renderer,Statics:{MAX_BATCH_NUM:2000,ATTRIBUTE_NUM:5,isSupport:null},renderType:"webgl",gl:null,constructor:function(e){c.superclass.constructor.call(this,e);e=this.gl=this.canvas.getContext("webgl",{stencil:!0})||this.canvas.getContext("experimental-webgl",{stencil:!0});e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);e.enable(e.BLEND);e.disable(e.CULL_FACE);e.disable(e.DEPTH_TEST);e.disable(e.STENCIL_TEST);this._initShaders();this.vertex2=new Float32Array(8);this.indexs2=new Uint16Array([0,1,2,1,2,3]);this.notextureShader.active();e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indexs2,e.STATIC_DRAW);e.bufferData(e.ARRAY_BUFFER,this.vertex2,e.STREAM_DRAW);this.maxBatchNum=c.MAX_BATCH_NUM;this.positionStride=4*c.ATTRIBUTE_NUM;var h=6*this.maxBatchNum;this.vertex=new Float32Array(this.maxBatchNum*c.ATTRIBUTE_NUM*4);this.indexs=new Uint16Array(h);for(var b=0,g=0;b<h;b+=6,g+=4){this.indexs[b+0]=g+0,this.indexs[b+1]=g+1,this.indexs[b+2]=g+2,this.indexs[b+3]=g+1,this.indexs[b+4]=g+2,this.indexs[b+5]=g+3}this.batchIndex=0;this.sprites=[];this.defaultShader.active();e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indexs,e.STATIC_DRAW);e.bufferData(e.ARRAY_BUFFER,this.vertex,e.STREAM_DRAW)},context:null,startDraw:function(a){return a.visible&&0<a.alpha?(a.__webglWorldMatrix=a.__webglWorldMatrix||new k(1,0,0,1,0,0),a.__webglRenderAlpha=a.__webglRenderAlpha||1,!0):!1},draw:function(h){var o=h.drawable,g=o&&o.image,n=h.background;(this.batchIndex>=this.maxBatchNum||n)&&this._renderBatches();if(h.clipChildren){this.stencilLevel=this.stencilLevel||0;var e=this.gl;0===this.stencilLevel?(e.enable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.stencilFunc(e.ALWAYS,1,255),e.stencilOp(e.KEEP,e.REPLACE,e.REPLACE)):e.stencilOp(e.KEEP,e.INCR,e.INCR);e.colorMask(!1,!1,!1,!1);this.notextureShader.active();this._renderBackground(h,{r:1,g:1,b:1});this.stencilLevel+=1;e.colorMask(!0,!0,!0,!0);e.stencilFunc(e.LEQUAL,this.stencilLevel,255);e.stencilOp(e.KEEP,e.KEEP,e.KEEP)}n&&(this.notextureShader.active(),this._renderBackground(h,n.toColorRgb()));g&&(this.defaultShader.active(),this._renderImage(h,g,o.rect))},endDraw:function(a){a===this.stage&&this._renderBatches();a.clipChildren&&(a=this.gl,--this.stencilLevel,a.stencilFunc(a.LEQUAL,this.stencilLevel,255),0==this.stencilLevel&&(this._renderBatches(),a.disable(this.gl.STENCIL_TEST)))},transform:function(a){this._setConcatenatedMatrix(a,a.parent);0<a.alpha&&(a.__webglRenderAlpha=a.parent&&a.parent.__webglRenderAlpha?a.alpha*a.parent.__webglRenderAlpha:a.alpha)},clear:function(e,h,b,g){this.gl.clear(this.gl.COLOR_BUFFER_BIT)},resize:function(a,b){if(this.width!==a||this.height!==b){this.width=this.canvas.width=a,this.height=this.canvas.height=b,this.gl.viewport(0,0,a,b),this.activeShader.active(!0)}},_renderBackground:function(r,u){var o=this.gl,t=r.__webglRenderAlpha;o.uniform4f(this.activeShader.u_color,u.r/255*t,u.g/255*t,u.b/255*t,t);var n=r.width,s=r.height,t=-r.pivotX,q=r.pivotY-s,p=this.vertex2;p[0]=t;p[1]=q;p[2]=t+n;p[3]=q;p[4]=t;p[5]=q+s;p[6]=t+n;p[7]=q+s;n=r.__webglWorldMatrix;for(s=0;4>s;s++){t=p[2*s],q=p[2*s+1],p[2*s]=n.a*t+n.c*q+n.tx,p[2*s+1]=n.b*t+n.d*q+n.ty}o.bufferData(o.ARRAY_BUFFER,p,o.STREAM_DRAW);o.drawElements(o.TRIANGLES,6,o.UNSIGNED_SHORT,0)},_renderImage:function(r,u,o){u.texture||this.activeShader.uploadTexture(u);var t=this._createVertexs(u,o[0],o[1],o[2],o[3],-r.pivotX,-r.pivotY,r.width,r.height);o=this.batchIndex*this.positionStride;var n=this.vertex,s=r.__webglRenderAlpha;n[o+0]=t[0];n[o+1]=t[1];n[o+2]=t[2];n[o+3]=t[3];n[o+4]=s;n[o+5]=t[4];n[o+6]=t[5];n[o+7]=t[6];n[o+8]=t[7];n[o+9]=s;n[o+10]=t[8];n[o+11]=t[9];n[o+12]=t[10];n[o+13]=t[11];n[o+14]=s;n[o+15]=t[12];n[o+16]=t[13];n[o+17]=t[14];n[o+18]=t[15];n[o+19]=s;t=r.__webglWorldMatrix;for(s=0;4>s;s++){var q=n[o+5*s],p=n[o+5*s+1];n[o+5*s]=t.a*q+t.c*p+t.tx;n[o+5*s+1]=t.b*q+t.d*p+t.ty}r.texture=u.texture;this.sprites[this.batchIndex++]=r},_renderBatches:function(){var g=this.gl;g.bufferSubData(g.ARRAY_BUFFER,0,this.vertex.subarray(0,this.batchIndex*this.positionStride));for(var g=0,n=null,h=0;h<this.batchIndex;h++){var e=this.sprites[h];n&&n!==e.texture&&(this._renderBatch(g,h),g=h);n=e.texture}this._renderBatch(g,this.batchIndex);this.batchIndex=0},_renderBatch:function(g,n){var h=this.gl,e=n-g;0<e&&(h.bindTexture(h.TEXTURE_2D,this.sprites[g].texture),h.drawElements(h.TRIANGLES,6*e,h.UNSIGNED_SHORT,12*g))},_initShaders:function(){this.defaultShader=new m(this,{v:"attribute vec2 a_position;\nattribute vec2 a_TexCoord;\nattribute float a_alpha;\nuniform mat3 u_projectionTransform;\nvarying vec2 v_TexCoord;\nvarying float v_alpha;\nvoid main(){\n    gl_Position =  vec4((u_projectionTransform * vec3(a_position, 1.0)).xy, 1.0, 1.0);\n    v_TexCoord = a_TexCoord;\n    v_alpha = a_alpha;\n}\n",f:"\nprecision mediump float;\nuniform sampler2D u_Sampler;\nvarying vec2 v_TexCoord;\nvarying float v_alpha;\nvoid main(){\n    gl_FragColor = texture2D(u_Sampler, v_TexCoord) * v_alpha;\n}\n"},{attributes:[{name:"a_position",count:2,offset:0,stride:20},{name:"a_TexCoord",count:2,offset:8,stride:20},{name:"a_alpha",count:1,offset:16,stride:20}],uniforms:["u_projectionTransform","u_Sampler"]});this.notextureShader=new m(this,{v:"attribute vec2 a_position;\nuniform mat3 u_projectionTransform;\nvoid main(){\n    gl_Position =  vec4((u_projectionTransform * vec3(a_position, 1.0)).xy, 1.0, 1.0);\n}\n",f:"\nprecision mediump float;\nuniform vec4 u_color;\nvoid main(){\n    gl_FragColor = u_color;\n}\n"},{attributes:[{name:"a_position",count:2,offset:0,stride:8}],uniforms:["u_projectionTransform","u_color"]})},_createVertexs:function(A,y,x,z,w,v,u,s,o){var t=this.__tempVertexs||[],r=A.width;A=A.height;z/=r;w/=A;y/=r;x/=A;1<z+y&&(z=1-y);1<w+x&&(w=1-x);x=1-x-w;u=-o-u;r=0;t[r++]=v;t[r++]=u;t[r++]=y;t[r++]=x;t[r++]=v+s;t[r++]=u;t[r++]=y+z;t[r++]=x;t[r++]=v;t[r++]=u+o;t[r++]=y;t[r++]=x+w;t[r++]=v+s;t[r++]=u+o;t[r++]=y+z;t[r++]=x+w;return t},_setConcatenatedMatrix:function(o,v){var s=o.__webglWorldMatrix,e=1,r=0,q=360-o.rotation%360,p=o.scaleX,t=o.scaleY;q&&(r=q*l,e=Math.cos(r),r=Math.sin(r));s.a=e*p;s.b=r*p;s.c=-r*t;s.d=e*t;s.tx=o.x;s.ty=-o.y;e=v.__webglWorldMatrix;s.concat(e.a,e.b,e.c,e.d,e.tx,e.ty)}}),f={},m=function(b,g,e){this.renderer=b;this.gl=b.gl;this.program=this._createProgram(this.gl,g.v,g.f);e=e||{};this.attributes=e.attributes||[];this.uniforms=e.uniforms||[];this.vertexBuffer=this.gl.createBuffer();this.indexBuffer=this.gl.createBuffer()};m.prototype={active:function(n){var r=this,q=r.renderer,h=q.activeShader;if(h!==r||n){var p=r.gl,o=r.program;o&&p&&(h&&h.attributes.forEach(function(b){p.disableVertexAttribArray(h[b.name])}),q.activeShader=r,p.useProgram(o),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,r.indexBuffer),p.bindBuffer(p.ARRAY_BUFFER,r.vertexBuffer),r.attributes.forEach(function(b){attribute=b.name;r[attribute]=r[attribute]||p.getAttribLocation(o,attribute);p.enableVertexAttribArray(r[attribute]);p.vertexAttribPointer(r[attribute],b.count,p.FLOAT,!1,b.stride,b.offset)}),r.uniforms.forEach(function(b){r[b]=r[b]||p.getUniformLocation(o,b)}),r.width!==q.width||r.height!==q.height)&&(r.width=q.width,r.height=q.height,r.uploadProjectionTransform(!0))}},uploadTexture:function(a){var e=this.gl;if(f[a.src]){a.texture=f[a.src]}else{var b=e.createTexture();e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,b);e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1);e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,a);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.uniform1i(this.u_Sampler,0);e.bindTexture(e.TEXTURE_2D,null);a.texture=b;f[a.src]=b}},uploadProjectionTransform:function(b){var d=this.gl;if(!this._projectionTransformElements||b){this._projectionTransformElements=new Float32Array([2/this.width,0,0,0,2/this.height,0,-1,1,1])}d.uniformMatrix3fv(this.u_projectionTransform,!1,this._projectionTransformElements)},_createProgram:function(g,n,h){n=this._createShader(g,g.VERTEX_SHADER,n);var e=this._createShader(g,g.FRAGMENT_SHADER,h);if(!n||!e){return null}if(h=g.createProgram()){if(g.attachShader(h,n),g.attachShader(h,e),g.linkProgram(h),g.deleteShader(e),g.deleteShader(n),!g.getProgramParameter(h,g.LINK_STATUS)){return n=g.getProgramInfoLog(h),console.log("Failed to link program: "+n),g.deleteProgram(h),null}}return h},_createShader:function(b,g,e){if(g=b.createShader(g)){if(b.shaderSource(g,e),b.compileShader(g),!b.getShaderParameter(g,b.COMPILE_STATUS)){return e=b.getShaderInfoLog(g),console.log("Failed to compile shader: "+e),b.deleteShader(g),null}}return g}};c.isSupport=function(){if(void 0===this._isSupport){var b=document.createElement("canvas");b.getContext&&(b.getContext("webgl")||b.getContext("experimental-webgl"))?this._isSupport=!0:this._isSupport=!1}return this._isSupport};j.WebGLRenderer=c})(window);(function(a){a=a.Hilo;var b=a.Class.create({Extends:a.Renderer,constructor:function(c){b.superclass.constructor.call(this,c);this.context=this.canvas.getContext("2d")},renderType:"canvas",context:null,startDraw:function(c){return c.visible&&0<c.alpha?(this.context.save(),!0):!1},draw:function(j){var c=this.context,g=j.width,k=j.height;j.clipChildren&&(c.beginPath(),c.rect(0,0,g,k),c.clip());var h=j.background;h&&(c.fillStyle=h,c.fillRect(0,0,g,k));if(j=(h=j.drawable)&&h.image){h=h.rect,c.drawImage(j,h[0],h[1],h[2],h[3],0,0,g,k)}},endDraw:function(c){this.context.restore()},transform:function(w){var z=this.context,A=w.x,x=w.y,t=w.scaleX,y=w.scaleY,p=w.pivotX,s=w.pivotY,r=w.rotation%360,B=w.align;if(B){if("function"===typeof B){w.align()}else{var C=w.parent;if(C){var m=w.width,j=w.height,o=C.width,C=C.height;switch(B){case"TL":x=A=0;break;case"T":A=o-m>>1;x=0;break;case"TR":A=o-m;x=0;break;case"L":A=0;x=C-j>>1;break;case"C":A=o-m>>1;x=C-j>>1;break;case"R":A=o-m;x=C-j>>1;break;case"BL":A=0;x=C-j;break;case"B":A=o-m>>1;x=C-j;break;case"BR":A=o-m,x=C-j}}}}0==A&&0==x||z.translate(A,x);0!=r&&z.rotate(r*Math.PI/180);1==t&&1==y||z.scale(t,y);0==p&&0==s||z.translate(-p,-s);0<w.alpha&&(z.globalAlpha*=w.alpha)},clear:function(g,c,f,h){this.context.clearRect(g,c,f,h)},resize:function(d,c){this.canvas.width=d;this.canvas.height=c}});a.CanvasRenderer=b})(window);(function(f){var j=f.Hilo,k=j.Class,c=j.Event,d=j.Matrix;f=function(){function a(E,B,A){for(var C=E.length,z=B.length,y,v,t,o,u,s,m=0,F=y=0;F<C;F++){y=E[F];v=E[F<C-1?F+1:0];m=y.y-v.y;y=v.x-y.x;v=Math.sqrt(m*m+y*y);m/=v;y/=v;v=t=E[0].x*m+E[0].y*y;for(var D=1;D<C;D++){s=E[D].x*m+E[D].y*y,s>t?t=s:s<v&&(v=s)}o=u=B[0].x*m+B[0].y*y;for(D=1;D<z;D++){s=B[D].x*m+B[D].y*y,s>u?u=s:s<o&&(o=s)}v<o?(v=o-t,m=-m,y=-y):v-=u;if(0<=v){return !1}v>A.overlap&&(A.overlap=v,A.normal.x=m,A.normal.y=y)}return A}return k.create({Mixes:c,constructor:function(b){b=b||{};this.id=this.id||b.id||j.getUid("View");j.copy(this,b,!0)},id:null,x:0,y:0,width:0,height:0,alpha:1,rotation:0,visible:!0,pivotX:0,pivotY:0,scaleX:1,scaleY:1,pointerEnabled:!0,background:null,align:null,drawable:null,boundsArea:null,parent:null,depth:-1,getStage:function(){for(var b=this,e;e=b.parent;){b=e}return b.canvas&&b.renderer?b:null},getScaledWidth:function(){return this.width*this.scaleX},getScaledHeight:function(){return this.height*this.scaleY},addTo:function(b,e){"number"===typeof e?b.addChildAt(this,e):b.addChild(this);return this},removeFromParent:function(){var b=this.parent;b&&b.removeChild(this);return this},fixSize:function(){if(!this.width||!this.height){var b=this.drawable&&this.drawable.rect;b&&(this.width=b[2],this.height=b[3])}},getBounds:function(){for(var B=this.width,z=this.height,y=this.getConcatenatedMatrix(),B=this.boundsArea||[{x:0,y:0},{x:B,y:0},{x:B,y:z},{x:0,y:z}],z=[],A,x,w,v,t,o,u,s=0,m=B.length;s<m;s++){A=y.transformPoint(B[s],!0,!0),x=A.x,w=A.y,0==s?(v=t=x,o=u=w):(v>x?v=x:t<x&&(t=x),o>w?o=w:u<w&&(u=w)),z[s]=A}z.x=v;z.y=o;z.width=t-v;z.height=u-o;return z},getConcatenatedMatrix:function(t){for(var w=new d(1,0,0,1,0,0),v=this;v!=t&&v.parent;v=v.parent){var x=1,u=0,s=v.rotation%360,r=v.pivotX,o=v.pivotY,m=v.scaleX,p=v.scaleY;s&&(u=s*Math.PI/180,x=Math.cos(u),u=Math.sin(u));0!=r&&(w.tx-=r);0!=o&&(w.ty-=o);w.concat(x*m,u*m,-u*p,x*p,v.x,v.y)}return w},hitTestPoint:function(E,B,A){var C=this.getBounds(),z=E>=C.x&&E<=C.x+C.width&&B>=C.y&&B<=C.y+C.height;if(z&&A){A=0;for(var z=!1,y,v,t,o,u=0,s=C.length;u<s;u++){var m=C[u],F=C[(u+1)%s];if(m.y==F.y&&B==m.y&&(m.x>F.x?(y=F.x,v=m.x):(y=m.x,v=F.x),E>=y&&E<=v)){z=!0;continue}m.y>F.y?(t=F.y,o=m.y):(t=m.y,o=F.y);if(!(B<t||B>o)){var D=(B-m.y)*(F.x-m.x)/(F.y-m.y)+m.x;D>E?A++:D==E&&(z=!0);m.x>E&&m.y==B&&(m=C[(s+u-1)%s],(m.y<B&&F.y>B||m.y>B&&F.y<B)&&A++)}}z=z||1==A%2}return z},hitTestObject:function(l,o){var h=this.getBounds(),n=l.getBounds(),m=h.x<=n.x+n.width&&n.x<=h.x+h.width&&h.y<=n.y+n.height&&n.y<=h.y+h.height;m&&o&&(m=(m=a(h,n,{overlap:-Infinity,normal:{x:0,y:0}}))?a(n,h,m):!1);return !!m},_render:function(b,e){this.onUpdate&&!1===this.onUpdate(e)||!b.startDraw(this)||(b.transform(this),this.render(b,e),b.endDraw(this))},_fireMouseEvent:function(b){b.eventCurrentTarget=this;this.fire(b);if("mousemove"==b.type){if(!this.__mouseOver){this.__mouseOver=!0;var e=j.copy({},b);e.type="mouseover";this.fire(e)}}else{"mouseout"==b.type&&(this.__mouseOver=!1)}e=this.parent;b._stopped||b._stopPropagationed||!e||("mouseout"==b.type||"touchout"==b.type?e.hitTestPoint(b.stageX,b.stageY,!0)||e._fireMouseEvent(b):e._fireMouseEvent(b))},onUpdate:null,render:function(b,e){this.fixSize();b.draw(this)},toString:function(){for(var b,e=this;e;){b=b?e.id+"."+b:e.id,e=e.parent}return b}})}();j.View=f})(window);(function(c){var d=c.Hilo,f=d.Drawable,a=d.Class.create({Extends:d.View,constructor:function(b){b=b||{};this.id=this.id||b.id||d.getUid("Container");a.superclass.constructor.call(this,b);this.children?this._updateChildren():this.children=[]},children:null,pointerChildren:!0,clipChildren:!1,getChildrenNum:function(){return this.children.length},addChildAt:function(h,l){var j=this.children,m=j.length,g=h.parent;l=0>l?0:l>m?m:l;var k=this.getChildIndex(h);if(k==l){return this}0<=k?(j.splice(k,1),l=l==m?m-1:l):g&&g.removeChild(h);j.splice(l,0,h);0>k?this._updateChildren(l):this._updateChildren(k<l?k:l,(k<l?l:k)+1);h.drawable&&h.drawable.domElement&&(this._domContainerFlag=!0);return this},addChild:function(g){for(var j=this.children.length,h=arguments,k=0,e=h.length;k<e;k++){this.addChildAt(h[k],j+k)}return this},removeChildAt:function(h){var l=this.children;if(0>h||h>=l.length){return null}var j=l[h];if(j){var m=j.drawable,g=m&&m.domElement;if(g){var k=g.parentNode;k&&k.removeChild(g);m.domElement=null;this._domContainerFlag=!0}j.parent=null;j.depth=-1}l.splice(h,1);this._updateChildren(h);return j},removeChild:function(b){return this.removeChildAt(this.getChildIndex(b))},removeChildById:function(g){for(var j=this.children,h,k=0,e=j.length;k<e;k++){if(h=j[k],h.id===g){return this.removeChildAt(k),h}}return null},removeAllChildren:function(){for(;this.children.length;){this.removeChildAt(0)}return this},getChildAt:function(b){var e=this.children;return 0>b||b>=e.length?null:e[b]},getChildById:function(g){for(var j=this.children,h,k=0,e=j.length;k<e;k++){if(h=j[k],h.id===g){return h}}return null},getChildIndex:function(b){return this.children.indexOf(b)},setChildIndex:function(g,j){var h=this.children,k=h.indexOf(g);if(0<=k&&k!=j){var e=h.length;j=0>j?0:j>=e?e-1:j;h.splice(k,1);h.splice(j,0,g);this._updateChildren()}return this},swapChildren:function(g,j){var h=this.children,k=this.getChildIndex(g),e=this.getChildIndex(j);g.depth=e;h[e]=g;j.depth=k;h[k]=j},swapChildrenAt:function(g,j){var h=this.children,k=this.getChildAt(g),e=this.getChildAt(j);k.depth=j;h[j]=k;e.depth=g;h[g]=e},sortChildren:function(g){var h=this.children;if("string"==typeof g){var e=g;g=function(b,j){return j[e]-b[e]}}h.sort(g);this._updateChildren()},_updateChildren:function(h,k){var g=this.children,l;k=k||g.length;for(var j=h||0;j<k;j++){l=g[j],l.depth=j+1,l.parent=this}},contains:function(b){for(;b=b.parent;){if(b===this){return !0}}return !1},getViewAtPoint:function(r,o,q,p,m){if(this.clipChildren&&!this.hitTestPoint(r,o,q)){return null}for(var l=p?[]:null,k=this.children,s,t,j=k.length-1;0<=j;j--){if(s=k[j],!(!s||!s.visible||0>=s.alpha||m&&!s.pointerEnabled)){if(s.children&&s.children.length&&(!m||s.pointerChildren)&&(t=s.getViewAtPoint(r,o,q,p,m)),t){if(p){t.length&&(l=l.concat(t))}else{return t}}else{if(s.hitTestPoint(r,o,q)){if(p){l.push(s)}else{return s}}}}}return p&&l.length?l:null},render:function(b,l){a.superclass.render.call(this,b,l);"dom"!=b.renderType&&(this._domContainerFlag&&(this._domContainerFlag=!1,this._domContainerUpdate()),this.drawable&&this.drawable.domElement&&d.setElementStyleByView(this,!0));var j=this.children.slice(0),m,k,g;m=0;for(k=j.length;m<k;m++){g=j[m],g._render(b,l)}},_domContainerUpdate:function(){var g=this.children,h=!1;i=0;for(len=g.length;i<len;i++){if(child=g[i],child.drawable&&child.drawable.domElement){h=!0;break}}var g=this.parent,e=this.drawable,j=e&&e.domElement;h?j||(e=this.drawable=this.drawable||new f,e.domElement=e.domElement||d.createElement("div",{style:{position:"absolute"}}),g&&g._domContainerUpdate()):j&&(j&&((h=j.parentNode)&&h.removeChild(j),this.drawable=e.domElement=null),g&&g._domContainerUpdate())}});d.Container=a})(window);(function(j){var k=j.Hilo,l=k.CanvasRenderer,c=k.DOMRenderer,f=k.WebGLRenderer,m=k.Class.create({Extends:k.Container,constructor:function(g){g=g||{};this.id=this.id||g.id||k.getUid("Stage");m.superclass.constructor.call(this,g);this._initRenderer(g);var n=this.width,d=this.height,h=this.updateViewport();g.width||(n=h&&h.width||320);g.height||(d=h&&h.height||480);this.resize(n,d,!0)},canvas:null,renderer:null,paused:!1,viewport:null,_initRenderer:function(b){var e=b.canvas,a=b.container;b=b.renderType||"canvas";"string"===typeof e&&(e=k.getElement(e));"string"===typeof a&&(a=k.getElement(a));e||(e=k.createElement("dom"===b?"div":"canvas",{style:{position:"absolute",overflow:"hidden"}}));this.canvas=e;a&&a.appendChild(e);e={canvas:e,stage:this};switch(b){case"dom":this.renderer=new c(e);break;case"webgl":f.isSupport()?this.renderer=new f(e):this.renderer=new l(e);break;default:this.renderer=new l(e)}},_render:function(A,y){if((!this.onUpdate||!1!==this.onUpdate(y))&&A.startDraw(this)){var x=this.width,z=this.height,w=this.scaleX,v=this.scaleY,u=this._height,s=this._scaleX,o=this._scaleY,t=this.canvas,r=t.style;if(this._width!==x||s!==w){this._width=x,this._scaleX=w,t.width=x,r.width=w*x+"px"}if(u!==z||o!==v){this._height=z,this._scaleY=v,t.height=z,r.height=v*z+"px"}(x=this.drawable&&this.drawable.domElement)&&!x.parentNode&&(x.style.overflow="hidden",t.appendChild(x));A.clear(0,0,this.width,this.height);this.render(A,y);A.endDraw(this)}},addTo:function(b){var d=this.canvas;d.parentNode!==b&&b.appendChild(d);return this},tick:function(b){this.paused||this._render(this.renderer,b)},resize:function(b,g,e){if(e||this.width!==b||this.height!==g){this.width=b,this.height=g,this.renderer.resize(b,g),this.updateViewport()}},updateViewport:function(){var b=this.canvas,d=null;b.parentNode&&(d=this.viewport=k.getElementRect(b));return d},enableDOMEvent:function(o,t){var s=this,n=s.canvas,r="string"===typeof o?[o]:o;t=!1!==t;for(var q=s._domListener||(s._domListener=function(b){s._onDOMEvent(b)}),p=0;p<r.length;p++){o=r[p],t?n.addEventListener(o,q,!1):n.removeEventListener(o,q)}return s},_onDOMEvent:function(o){var v=o.type,s=0==v.indexOf("touch"),g=o;if(s){var r=o.touches,g=o.changedTouches,g=r&&r.length?r[0]:g&&g.length?g[0]:null}var r=g.pageX||g.clientX,g=g.pageY||g.clientY,q=this.viewport||this.updateViewport();o.stageX=r=(r-q.left)/this.scaleX;o.stageY=g=(g-q.top)/this.scaleY;o.stopPropagation=function(){this._stopPropagationed=!0};var r=this.getViewAtPoint(r,g,!0,!1,!0)||this,g=this.canvas,q=this._eventTarget,p="mouseout"===v;if(q&&(!(q==r||q.contains&&q.contains(r))||p)){if(p="touchmove"===v?"touchout":"mousemove"===v||p||!r?"mouseout":null){var t=k.copy({},o);t.type=p;t.eventTarget=q;q._fireMouseEvent(t)}o.lastEventTarget=q;this._eventTarget=null}r&&r.pointerEnabled&&"mouseout"!==v&&(o.eventTarget=this._eventTarget=r,r._fireMouseEvent(o));s||(g.style.cursor=r&&r.pointerEnabled&&r.useHandCursor?"pointer":"");k.browser.android&&"touchmove"===v&&o.preventDefault()},_domContainerUpdate:function(){m.superclass._domContainerUpdate.call(this);var b=this.drawable&&this.drawable.domElement;b&&!b.parentNode&&this.canvas.parentNode&&this.canvas.parentNode.appendChild(b)}});k.Stage=m})(window);(function(c){var d=c.Hilo,f=d.Drawable,a=d.Class.create({Extends:d.View,constructor:function(b){b=b||{};this.id=this.id||b.id||d.getUid("Bitmap");a.superclass.constructor.call(this,b);this.drawable=new f(b);if(!this.width||!this.height){if(b=this.drawable.rect){this.width=b[2],this.height=b[3]}}},setImage:function(b,e){this.drawable.init({image:b,rect:e});e&&(this.width=e[2],this.height=e[3]);return this}});d.Bitmap=a})(window);(function(c){var d=c.Hilo,f=d.Drawable,a=d.Class.create({Extends:d.View,constructor:function(b){b=b||{};this.id=this.id||b.id||d.getUid("Sprite");a.superclass.constructor.call(this,b);this._frames=[];this._frameNames={};this._frameCallbacks=[];this.drawable=new f;b.frames&&this.setFrames(b.frames)},_frames:null,_frameNames:null,_frameIndex:0,_framePaused:!1,_frameElapsed:0,_frameCallbacks:null,loop:!0,duration:1,setFrames:function(p){if(p instanceof Array){this._frames=p;this._frameNames={};for(var m=0,o=p.length;m<o;m++){var n=p[m];n.name&&(this._frameNames[n.name]=n)}}else{var o=p.image,m=p.rect||[0,0,o.width,o.height],n=m[0],l=m[1],k=p.width||m[2],j=p.height||m[3],q=Math.floor(m[2]/k);p=p.total||q*Math.floor(m[3]/j);for(var r=[],m=0;m<p;m++){r[m]={image:o,rect:[n+m%q*k,l+j*Math.floor(m/q),k,j]}}this.setFrames(r)}return this},getFrame:function(g){if("number"===typeof g){var e=this._frames;return 0>g||g>=e.length?null:e[g]}return this._frameNames[g]},getFrameIndex:function(j){if(null==j||void 0==j){return this._frameIndex}var h=this._frames,l=h.length,m=-1;if("number"===typeof j){m=j}else{if(j="string"===typeof j?this._frameNames[j]:j){for(var k=0;k<l;k++){if(j===h[k]){m=k;break}}}}return m},getFrameTotal:function(){return this._frames?this._frames.length:0},setFrameCallback:function(h,g){var j=this.getFrameIndex(h);-1<j&&(this._frameCallbacks[j]=g);return this},play:function(){this._framePaused=!1;return this},stop:function(){this._framePaused=!0;return this},"goto":function(h,g){var j=this._frames.length,k=this.getFrameIndex(h);this._frameIndex=0>k?0:k>=j?j-1:k;this._framePaused=g||this._framePaused;this._frameElapsed=0;return this},_render:function(b,h){var g=this._nextFrame(h);if(g!=this._frameIndex){this._frameIndex=g;var j=this._frameCallbacks[g];j&&j.call(this);g=this._frames[g];this.drawable.init(g);this.width=g.rect[2];this.height=g.rect[3]}a.superclass._render.call(this,b,h)},_nextFrame:function(j){var h=this._frameIndex;if(this._framePaused){return h}var l=this._frames,m=l.length,l=l[h];if(l.stop||!this.loop&&h>=m-1){return this.stop(),h}j=this._frameElapsed+j;var k=l.duration||this.duration;j>k?(this._frameElapsed=j-k,null!=l.next?h=this.getFrameIndex(l.next):h>=m-1?h=0:h++):this._frameElapsed=j;return h}});d.Sprite=a})(window);(function(c){var d=c.Hilo,f=d.Drawable,a=d.Class.create({Extends:d.View,constructor:function(b){b=b||{};this.id=this.id||b.id||d.getUid("Button");a.superclass.constructor.call(this,b);this.drawable=new f(b);this.setState(a.UP)},upState:null,overState:null,downState:null,disabledState:null,state:null,enabled:!0,useHandCursor:!0,setEnabled:function(b){this.enabled!=b&&(b?this.setState(a.UP):this.setState(a.DISABLED));return this},setState:function(b){if(this.state!==b){this.state=b;this.pointerEnabled=this.enabled=b!==a.DISABLED;var e;switch(b){case a.UP:e=this.upState;break;case a.OVER:e=this.overState;break;case a.DOWN:e=this.downState;break;case a.DISABLED:e=this.disabledState}e&&(this.drawable.init(e),d.copy(this,e,!0))}return this},fire:function(b,e){if(this.enabled){switch("string"===typeof b?b:b.type){case"mousedown":case"touchstart":case"touchmove":this.setState(a.DOWN);break;case"mouseover":this.setState(a.OVER);break;case"mouseup":this.overState?this.setState(a.OVER):this.upState&&this.setState(a.UP);break;case"touchend":case"touchout":case"mouseout":this.setState(a.UP)}return a.superclass.fire.call(this,b,e)}},Statics:{UP:"up",OVER:"over",DOWN:"down",DISABLED:"disabled"}});d.Button=a})(window);(function(k){var l=k.Hilo;k=l.Class;var n=l.Drawable,c=l.View,j=l.createElement("canvas"),o=j&&j.getContext("2d"),m=k.create({Extends:c,constructor:function(b){b=b||{};this.id=this.id||b.id||l.getUid("Text");m.superclass.constructor.call(this,b);b.width?(this.width=b.width,this._autoWidth=!1):(this.width=256,this._autoWidth=!0);b.height?(this.height=b.height,this._autoHeight=!1):(this.height=256,this._autoHeight=!0);this.setFont(b.font||"16px arial")},text:null,color:"#000",textAlign:null,outline:!1,lineSpacing:0,font:null,setFont:function(b){this.font!==b&&(this.font=b,this._fontHeight=m.measureFontHeight(b));return this},render:function(g,f){if("canvas"===g.renderType){this._draw(g.context)}else{if("dom"===g.renderType){var p=this.drawable.domElement,h=p.style;this._check()&&(h.font=this.font,h.textAlign=this.textAlign,h.color=this.color,h.lineHeight=this._fontHeight+this.lineSpacing+"px",h["word-break"]="break-all",h["word-wrap"]="break-word",p.innerHTML=this.text.replace("\n","</br>"));g.draw(this);this._autoWidth?(this.width=p.offsetWidth,h.width=null):h.width=this.width+"px";this._autoHeight?(this.height=p.offsetHeight,h.height=null):h.height=this.height+"px"}else{this._check()&&this._cache(),g.draw(this)}}},_draw:function(E){var C=this.text.toString();if(C){E.font=this.font;E.textAlign=this.textAlign;E.textBaseline="top";var B=C.split(/\r\n|\r|\n|<br(?:[ \/])*>/),A=0,z=0,y=this._fontHeight+this.lineSpacing,u,s,v,C=[];u=0;for(len=B.length;u<len;u++){if(s=B[u],v=E.measureText(s).width,v<=this.width||this._autoWidth){C.push({text:s,y:z}),A<v&&(A=v),z+=y}else{v="";var t=0,d,F,D;F=0;for(wlen=s.length;F<wlen;F++){D=s[F],d=E.measureText(v+D).width,d>this.width?(C.push({text:v,y:z}),A<t&&(A=t),z+=y,v=D):(t=d,v+=D),F==wlen-1&&(C.push({text:v,y:z}),v!==D&&A<d&&(A=d),z+=y)}}}this._autoWidth&&(this.width=A);this._autoHeight&&(this.height=z);(B=this.background)&&E!==o&&(E.fillStyle=B,E.fillRect(0,0,this.width,this.height));this.outline?E.strokeStyle=this.color:E.fillStyle=this.color;for(u=0;u<C.length;u++){s=C[u],this._drawTextLine(E,s.text,s.y)}}},_drawTextLine:function(h,g,r){var q=0,p=this.width;switch(this.textAlign){case"center":q=p>>1;break;case"right":q=p}this.outline?h.strokeText(g,q,r):h.fillText(g,q,r)},_check:function(){var b=!0;this._text!==this.text&&(this._text=this.text,b=!0);this._color!==this.color&&(this._color=this.color,b=!0);this._font!==this.font&&(this._font=this.font,b=!0);return b},_cache:function(){j.width=this.width;j.height=this.height;o.clearRect(0,0,j.width,j.height);this._draw(o);var a=new Image;a.src=j.toDataURL();this.drawable=this.drawable||new n;this.drawable.init(a)},Statics:{measureFontHeight:function(f){f=l.createElement("div",{style:{font:f,position:"absolute"},innerHTML:"PM\u56fd\u5bb6"});var e=document.documentElement;e.appendChild(f);var g=f.offsetHeight;e.removeChild(f);return g}}});l.Text=m})(window);(function(c){var d=c.Hilo,f=d.Bitmap,a=d.Class.create({Extends:d.Container,constructor:function(b){b=b||{};this.id=this.id||b.id||d.getUid("Label");a.superclass.constructor.call(this,b);b.font&&this.setFont(b.font);if(b=b.text+""){this.text="",this.setText(b)}this.pointerChildren=!1},glyphs:null,spacing:0,text:"",textAlign:"left",setFont:function(l){var k=l.text.toString(),q=l.image,r=l.rect||[0,0,q.width,q.height],p=l.width||r[2],o=l.height||r[3];l=l.col||Math.floor(r[2]/p);for(var r={},j=0,n=k.length;j<n;j++){charStr=k.charAt(j),r[charStr]={image:q,rect:[j%l*p,o*Math.floor(j/l),p,o]}}this.glyphs=r;""!=this.text&&(k=this.text,this.text="",this.setText(k))},setText:function(j){j=j.toString();var o=j.length;if(this.text!=j){this.text=j;var n,p,l,k=l=0,b=0;for(n=0;n<o;n++){if(p=j.charAt(n),p=this.glyphs[p]){b=l+(0<l?this.spacing:0),this.children[n]?(l=this.children[n],l.setImage(p.image,p.rect)):(l=a._createBitmap(p),this.addChild(l)),l.x=b,l=b+p.rect[2],k=Math.max(k,p.rect[3])}}for(n=this.children.length-1;n>=o;n--){a._releaseBitmap(this.children[n]),this.removeChild(this.children[n])}this.width=l;this.height=k;this.setTextAlign();return this}},setTextAlign:function(b){this.textAlign=b||this.textAlign;switch(this.textAlign){case"center":this.pivotX=0.5*this.width;break;case"right":this.pivotX=this.width;break;default:this.pivotX=0}return this},Statics:{_pool:[],_createBitmap:function(b){var e;0<a._pool.length?(e=a._pool.pop(),e.setImage(b.image,b.rect)):(e=new f({image:b.image,rect:b.rect}),console.log(b.image,b.rect));return e},_releaseBitmap:function(b){a._pool.push(b)}}});d.Label=a})(window);(function(c){var d=c.Hilo,f=d.Drawable,a=d.Class.create({Extends:d.View,constructor:function(b){b=b||{};this.id=this.id||b.id||d.getUid("Element");a.superclass.constructor.call(this,b);this.drawable=new f;(this.drawable.domElement=b.element||d.createElement("div",{style:{position:"absolute"}})).id=this.id},_render:function(g,e){this.onUpdate&&!1===this.onUpdate(e)||this.visible&&this.render(g,e)},render:function(g,e){"dom"!=g.renderType?d.setElementStyleByView(this):g.draw(this)}});d.Element=a})(window);